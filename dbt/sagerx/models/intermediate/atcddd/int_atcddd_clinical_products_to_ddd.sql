with route_dose_form_map as (
    -- map adm_route to the dose_form_names in the clinical products table
    select 'Chewing gum' as route, 'Chewing Gum' as form
    union all select 'Inhal', 'Dry Powder Inhaler'
    union all select 'Inhal', 'Inhalation Powder'
    union all select 'Inhal', 'Inhalation Solution'
    union all select 'Inhal', 'Inhalation Spray'
    union all select 'Inhal', 'Inhalation Suspension'
    union all select 'Inhal', 'Metered Dose Inhaler'
    union all select 'Inhal.aerosol', 'Inhalation Spray'
    union all select 'Inhal.aerosol', 'Metered Dose Inhaler'
    union all select 'Inhal.powder', 'Dry Powder Inhaler'
    union all select 'Inhal.powder', 'Inhalation Powder'
    union all select 'Inhal.solution', 'Inhalation Solution'
    union all select 'N', 'Metered Dose Nasal Spray'
    union all select 'N', 'Nasal Gel'
    union all select 'N', 'Nasal Inhalant'
    union all select 'N', 'Nasal Powder'
    union all select 'N', 'Nasal Solution'
    union all select 'N', 'Nasal Spray'
    union all select 'N', 'Nasal Suspension'
    union all select 'N', 'Powder for Nasal Solution'
    union all select 'O', 'Chewable Bar'
    union all select 'O', 'Chewable Extended Release Oral Tablet'
    union all select 'O', 'Chewable Tablet'
    union all select 'O', 'Delayed Release Oral Capsule'
    union all select 'O', 'Delayed Release Oral Granules'
    union all select 'O', 'Delayed Release Oral Tablet'
    union all select 'O', 'Disintegrating Oral Tablet'
    union all select 'O', 'Effervescent Oral Tablet'
    union all select 'O', 'Extended Release Oral Capsule'
    union all select 'O', 'Extended Release Oral Tablet'
    union all select 'O', 'Extended Release Suspension'
    union all select 'O', 'Granules for Oral Solution'
    union all select 'O', 'Granules for Oral Suspension'
    union all select 'O', 'Oral Capsule'
    union all select 'O', 'Oral Cream'
    union all select 'O', 'Oral Film'
    union all select 'O', 'Oral Foam'
    union all select 'O', 'Oral Gel'
    union all select 'O', 'Oral Granules'
    union all select 'O', 'Oral Lozenge'
    union all select 'O', 'Oral Paste'
    union all select 'O', 'Oral Pellet'
    union all select 'O', 'Oral Powder'
    union all select 'O', 'Oral Solution'
    union all select 'O', 'Oral Spray'
    union all select 'O', 'Oral Suspension'
    union all select 'O', 'Oral Tablet'
    union all select 'O', 'Oral Wafer'
    union all select 'O', 'Powder for Oral Solution'
    union all select 'O', 'Powder for Oral Suspension'
    union all select 'O', 'Tablet for Oral Suspension'
    union all select 'P', 'Auto-Injector'
    union all select 'P', 'Cartridge'
    union all select 'P', 'Injectable Solution'
    union all select 'P', 'Injectable Suspension'
    union all select 'P', 'Injection'
    union all select 'P', 'Intraperitoneal Solution'
    union all select 'P', 'Jet Injector'
    union all select 'P', 'Pen Injector'
    union all select 'P', 'Prefilled Syringe'
    union all select 'R', 'Enema'
    union all select 'R', 'Rectal Cream'
    union all select 'R', 'Rectal Foam'
    union all select 'R', 'Rectal Gel'
    union all select 'R', 'Rectal Ointment'
    union all select 'R', 'Rectal Solution'
    union all select 'R', 'Rectal Spray'
    union all select 'R', 'Rectal Suppository'
    union all select 'SL', 'Buccal Film'
    union all select 'SL', 'Buccal Tablet'
    union all select 'SL', 'Sublingual Film'
    union all select 'SL', 'Sublingual Powder'
    union all select 'SL', 'Sublingual Tablet'
    union all select 'SL', 'Sustained Release Buccal Tablet'
    union all select 'SL', 'Mucosal Spray'
    union all select 'SL', 'Mucous Membrane Topical Solution'
    union all select 'TD', 'Medicated Patch'
    union all select 'TD', 'Transdermal System'
    union all select 'V', 'Douche'
    union all select 'V', 'Vaginal Cream'
    union all select 'V', 'Vaginal Gel'
    union all select 'V', 'Vaginal Insert'
    union all select 'V', 'Vaginal Ointment'
    union all select 'V', 'Vaginal System'
    union all select 'implant', 'Drug Implant'
    union all select 'implant', 'Intrauterine System'
    union all select 's.c. implant', 'Drug Implant'
    union all select 'urethral', 'Urethral Gel'
    union all select 'urethral', 'Urethral Suppository'
    union all select 'oral aerosol', 'Oral Spray'
),
ingredient_to_ddd as (
    select *
    from {{ ref('stg_atcddd__ingredient_to_ddd') }}
),
clinical_product_to_ddd as (
    select 
        c.*,
        i.ddd,
        i.uom,
        i.adm_route,
        i.note
    from {{ ref('int_rxnorm_clinical_products_to_ingredient_components') }} c
    join ingredient_to_ddd i on i.rxcui = c.ingredient_component_rxcui
    join route_dose_form_map m on i.adm_route = m.route and c.dose_form_name = m.form
)
select * from clinical_product_to_ddd