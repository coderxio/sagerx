{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.3", "generated_at": "2025-05-29T02:24:58.811564Z", "invocation_id": "f55d52bb-75cb-436d-9fb6-fa27db3f81e9", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.037152Z", "completed_at": "2025-05-29T02:24:58.045711Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.046772Z", "completed_at": "2025-05-29T02:24:58.046803Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010576963424682617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.fda_excluded", "compiled": true, "compiled_code": "SELECT\n\t\n  \n  CASE WHEN \n  \n  \n    CASE WHEN pack.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN pack.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN pack.ndcpackagecode\n     WHEN \n  \n  \n    CASE WHEN pack.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(pack.ndcpackagecode,4) || REPLACE(RIGHT(pack.ndcpackagecode,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN pack.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(pack.ndcpackagecode,5) || '0' || REPLACE(RIGHT(pack.ndcpackagecode,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN pack.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(pack.ndcpackagecode,10),'-','') || '0' || RIGHT(pack.ndcpackagecode, 1)\n     WHEN \n  \n  \n    CASE WHEN pack.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(pack.ndcpackagecode,'-','')\n     WHEN \n  \n  \n    CASE WHEN pack.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN pack.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN pack.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN pack.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n AS ndc11\n\t, pack.productid\n\t, pack.productndc\n\t, producttypename\n\t, proprietaryname\n\t, proprietarynamesuffix\n\t, nonproprietaryname\n\t, dosageformname\n\t, routename\n\t, pack.startmarketingdate\n\t, pack.endmarketingdate\n\t, marketingcategoryname\n\t, applicationnumber\n\t, labelername\n\t, substancename\n\t, active_numerator_strength\n\t, active_ingred_unit\n\t, pharm_classes\n\t, deaschedule\n\t, pack.ndc_exclude_flag\n\t, listing_record_certified_through\n\t, ndcpackagecode\n\t, packagedescription\n\t, sample_package\nFROM \"sagerx\".\"sagerx_lake\".\"fda_excluded_package\" AS pack\nLEFT JOIN \"sagerx\".\"sagerx_lake\".\"fda_excluded_product\" AS prod\n\tON pack.productid = prod.productid", "relation_name": "\"sagerx\".\"sagerx_dev\".\"fda_excluded\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.052236Z", "completed_at": "2025-05-29T02:24:58.057856Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.058883Z", "completed_at": "2025-05-29T02:24:58.058906Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009161233901977539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxclass_clinical_products_to_atc_class", "compiled": true, "compiled_code": "select distinct\n\trs.atv as clinical_product_ndc,\n\trcl.rxcui as clinical_product_rxcui,\n\trcl.name as clinical_product_name,\n\trcl.class_id as clinical_product_code,\n\trcl.class_name as clinical_product_class_name\nfrom sagerx_lake.rxnorm_rxnsat rs\njoin sagerx_lake.rxnorm_rxnconso rc on rs.rxaui = rc.rxaui\njoin sagerx_lake.rxclass rcl on rcl.rxcui = rs.rxcui\nwhere\n\trs.atn = 'NDC'\n\tand rc.sab = 'RXNORM'\n\tand rcl.rela_source = 'ATCPROD'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxclass_clinical_products_to_atc_class\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.064152Z", "completed_at": "2025-05-29T02:24:58.068293Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.069014Z", "completed_at": "2025-05-29T02:24:58.069031Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007251262664794922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxclass_clinical_products_to_cvx_code", "compiled": true, "compiled_code": "select distinct\n\trs.atv as clinical_product_ndc,\n\trcl.rxcui as clinical_product_rxcui,\n\trcl.name as clinical_product_name,\n\trcl.class_id as clinical_product_code,\n\trcl.class_name as clinical_product_class_name\nfrom sagerx_lake.rxnorm_rxnsat rs\njoin sagerx_lake.rxnorm_rxnconso rc on rs.rxaui = rc.rxaui\njoin sagerx_lake.rxclass rcl on rcl.rxcui = rs.rxcui\nwhere\n\trs.atn = 'NDC'\n\tand rc.sab = 'RXNORM'\n\tand rcl.rela_source = 'CDC'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxclass_clinical_products_to_cvx_code\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.072107Z", "completed_at": "2025-05-29T02:24:58.075182Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.075654Z", "completed_at": "2025-05-29T02:24:58.075666Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004901885986328125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxclass_clinical_products_to_schedule", "compiled": true, "compiled_code": "select distinct\n\trs.atv as clinical_product_ndc,\n\trcl.rxcui as clinical_product_rxcui,\n\trcl.name as clinical_product_name,\n\trcl.class_id as clinical_product_code,\n\trcl.class_name as clinical_product_class_name\nfrom sagerx_lake.rxnorm_rxnsat rs\njoin sagerx_lake.rxnorm_rxnconso rc on rs.rxaui = rc.rxaui\njoin sagerx_lake.rxclass rcl on rcl.rxcui = rs.rxcui\nwhere\n\trs.atn = 'NDC'\n\tand rc.sab = 'RXNORM'\n\tand rcl.rela_source = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxclass_clinical_products_to_schedule\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.077924Z", "completed_at": "2025-05-29T02:24:58.080501Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.080918Z", "completed_at": "2025-05-29T02:24:58.080925Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004042863845825195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxclass_clinical_products_to_va_class", "compiled": true, "compiled_code": "select distinct\n\trs.atv as clinical_product_ndc,\n\trcl.rxcui as clinical_product_rxcui,\n\trcl.name as clinical_product_name,\n\trcl.class_id as clinical_product_code,\n\trcl.class_name as clinical_product_class_name\nfrom sagerx_lake.rxnorm_rxnsat rs\njoin sagerx_lake.rxnorm_rxnconso rc on rs.rxaui = rc.rxaui\njoin sagerx_lake.rxclass rcl on rcl.rxcui = rs.rxcui\nwhere\n\trs.atn = 'NDC'\n\tand rc.sab = 'RXNORM'\n\tand rcl.rela_source = 'VA'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxclass_clinical_products_to_va_class\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.082836Z", "completed_at": "2025-05-29T02:24:58.087316Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.087684Z", "completed_at": "2025-05-29T02:24:58.087691Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005745887756347656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_ashp__current_drug_shortages", "compiled": true, "compiled_code": "-- stg_ashp__current_drug_shortages.sql\n\nwith \n\nashp_shortage_list as (\n\n    select * from \"sagerx\".\"sagerx_lake\".\"ashp_shortage_list\"\n\n),\n\ncurrent_drug_shortages as (\n\n    select\n        split_part(detail_url, '=', 2)::int as id,\n        name,\n        concat(\n            'https://www.ashp.org/drug-shortages/current-shortages/',\n            lower(detail_url)) as url,\n        shortage_reasons::jsonb,\n        resupply_dates::jsonb,\n        alternatives_and_management::jsonb,\n        care_implications::jsonb,\n        safety_notices::jsonb,\n        created_date::date,\n        updated_date::date\n    from ashp_shortage_list\n\n)\n\nselect\n    *\nfrom current_drug_shortages", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_ashp__current_drug_shortages\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.089342Z", "completed_at": "2025-05-29T02:24:58.092022Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.092356Z", "completed_at": "2025-05-29T02:24:58.092362Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037932395935058594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_ashp__current_drug_shortages_ndcs", "compiled": true, "compiled_code": "-- stg_ashp__current_drug_shortages_ndcs.sql\n\nwith \n\nashp_shortage_list as (\n\n    select\n        detail_url,\n        -- Prepare description by removing any commas inside of parentheses\n        regexp_replace(ndc_description, '\\(([^)]*),([^)]*)\\)', '(\\1\\2)', 'g') as ndc_description,\n        ndc_type\n    from \"sagerx\".\"sagerx_lake\".\"ashp_shortage_list_ndcs\"\n\n),\n\ncurrent_drug_shortages_ndcs as (\n\n    select\n        split_part(detail_url, '=', 2)::int as id,\n        split_part(ndc_description, ',', 1) as product,\n        split_part(ndc_description, ',', 2) as manufacturer,\n        -- Split NDC description by commas and keep array items 3 through n-1\n        array_to_string((string_to_array(ndc_description, ','))[3:array_upper(string_to_array(ndc_description, ','), 1)-1], ',') as description,\n        -- Get NDC using regular expression\n        replace((regexp_match(ndc_description, '\\d{5}\\-\\d{4}\\-\\d{2}'))[1], '-', '') as ndc_11,\n        ndc_type\n    from ashp_shortage_list\n\n)\n\nselect\n    *\nfrom current_drug_shortages_ndcs", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_ashp__current_drug_shortages_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.093835Z", "completed_at": "2025-05-29T02:24:58.095442Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.095720Z", "completed_at": "2025-05-29T02:24:58.095726Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0025734901428222656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__interactions", "compiled": true, "compiled_code": "/* staging.stg_dailymed__interactions */\n\nwith xml_table as\n(\n\tselect zip_file, xml_content::xml as xml_column\n\tfrom sagerx_lake.dailymed\n)\n\nselect zip_file, y.*\n    from   xml_table x,\n            xmltable('dailymed/InteractionText'\n              passing xml_column\n              columns \n                document_id \t text  path '../documentId',\n\t\t\t\tset_id  \t\t text  path '../SetId',\n\t\t\t\tversion_number\t text  path '../VersionNumber',\n\t\t\t\tinteraction_text text path '.'\n\t\t\t\t\t) y", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__interactions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.097173Z", "completed_at": "2025-05-29T02:24:58.098592Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.098866Z", "completed_at": "2025-05-29T02:24:58.098870Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002457857131958008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__main", "compiled": true, "compiled_code": "/* staging.stg_dailymed__main */\n\nwith xml_table as\n(\n\tselect zip_file, xml_content::xml as xml_column\n\tfrom sagerx_lake.dailymed\n)\n\nselect zip_file, y.*, 'https://dailymed.nlm.nih.gov/dailymed/drugInfo.cfm?setid=' || y.set_id\n    from   xml_table x,\n            xmltable('dailymed'\n              passing xml_column\n              columns \n                document_id \tTEXT  PATH './documentId',\n\t\t\t\tset_id  \t\tTEXT  PATH './SetId',\n\t\t\t\tversion_number\tTEXT  PATH './VersionNumber',\n  \t\t\t\teffective_date\tTEXT  PATH './EffectiveDate',\n\t\t\t\tmarket_status\tTEXT  PATH './MarketStatus',\n\t\t\t\tapplication_number TEXT PATH './ApplicationNumber'\n\t\t\t\t\t) y", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__main\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.100155Z", "completed_at": "2025-05-29T02:24:58.102345Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.102620Z", "completed_at": "2025-05-29T02:24:58.102624Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0030765533447265625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__ndcs", "compiled": true, "compiled_code": "/* sagerx_dev.stg_dailymed__ndcs */\n\nwith xml_table as\n(\n\tselect zip_file, xml_content::xml as xml_column\n\tfrom sagerx_lake.dailymed\n),\n\nsql_table as (\n\n\tselect zip_file, y.*\n\t\tfrom   xml_table x,\n\t\t\t\txmltable('dailymed/NDCList/NDC'\n\t\t\t\tpassing xml_column\n\t\t\t\tcolumns \n\t\t\t\t\tdocument_id \ttext  path '../../documentId',\n\t\t\t\t\tset_id  \t\ttext  path '../../SetId',\n\t\t\t\t\tversion_number\t text  path '../../VersionNumber',\n\t\t\t\t\tndc\t\t\t\ttext  path '.'\n\t\t\t\t\t\t) y\n\n),\n\ncte as (\n\n\tselect\n\t\t*,\n\t\t\n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndc\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndc,4) || REPLACE(RIGHT(ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndc,5) || '0' || REPLACE(RIGHT(ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndc,10),'-','') || '0' || RIGHT(ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11\n\t\n\tfrom sql_table\n\n)\n\nselect * from cte", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.103906Z", "completed_at": "2025-05-29T02:24:58.105401Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.105675Z", "completed_at": "2025-05-29T02:24:58.105679Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002377748489379883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__organization_activities", "compiled": true, "compiled_code": "/* staging.stg_dailymed__organization_activities */\n \nwith xml_table as\n(\n\tselect zip_file, xml_content::xml as xml_column\n\tfrom sagerx_lake.dailymed\n)\n\nselect zip_file, y.*\n    from   xml_table x,\n            xmltable('/dailymed/Organizations/establishment/function'\n              passing xml_column\n              columns \n                document_id \ttext  path '../../../documentId',\n\t\t\t\tset_id  \t\ttext  path '../../../SetId',\n\t\t\t\tversion_number\t text  path '../VersionNumber',\n\t\t\t\tdun\t\t\t\ttext  path '../DUN',\n\t            activity\t\ttext  path './name'\n\t\t\t\t\t) y", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__organization_activities\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.106953Z", "completed_at": "2025-05-29T02:24:58.108470Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.108745Z", "completed_at": "2025-05-29T02:24:58.108749Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0023980140686035156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__organization_items", "compiled": true, "compiled_code": "/* staging.dailymed_organization_item */\n\nwith xml_table as\n(\n\tselect zip_file, xml_content::xml as xml_column\n\tfrom sagerx_lake.dailymed\n)\n\nselect zip_file, y.*\n    from   xml_table x,\n            xmltable('/dailymed/Organizations/establishment/function/item_list/item'\n              passing xml_column\n              columns\n                document_id \ttext  path '../../../../../documentId',\n\t\t\t\tset_id  \t\ttext  path '../../../../../SetId',\n\t\t\t\tversion_number\t text  path '../../../../../VersionNumber',\n\t\t\t\tdun\t\t\t\ttext  path '../../../DUN',\n\t            activity\t\ttext  path '../../name',\n\t\t\t\titem\t\t\ttext  path '.'\n\t\t\t\t\t) y", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__organization_items\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.110024Z", "completed_at": "2025-05-29T02:24:58.111550Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.111825Z", "completed_at": "2025-05-29T02:24:58.111829Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002402782440185547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__organization_texts", "compiled": true, "compiled_code": "/* staging.stg_dailymed__organization_texts */\n\nwith xml_table as\n(\n\tselect zip_file, xml_content::xml as xml_column\n\tfrom sagerx_lake.dailymed\n)\n\nselect zip_file\n\t\t, document_id\n\t\t, set_id \n\t\t, version_number\n\t\t, organization_text\n\t\t, row_num\nfrom (select zip_file\n\t\t, y.document_id\n\t\t, y.set_id\n\t\t, y.version_number\n\t\t, y.organization_text\n\t\t--,regexp_matches(organization_text, '(manufactured|distributed) (by|for):([\\s\\S]*)(?=manufactured|distributed|made)', 'ig') as mfdg_by_match\n\t\t,row_number() over (partition by zip_file order by length(organization_text) desc) as row_num\n    from   xml_table x,\n            xmltable('/dailymed/Organizations/OrganizationsText'\n              passing xml_column\n              columns \n                document_id \t\ttext path '../../documentId',\n\t\t\t\tset_id  \t\t\ttext path '../../SetId',\n\t\t\t\tversion_number\t text  path '../../VersionNumber',\n\t\t\t\torganization_text\ttext path '.' \n\t\t\t\t\t) y\n\t) z\nwhere row_num = 1", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__organization_texts\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.113113Z", "completed_at": "2025-05-29T02:24:58.114629Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.114903Z", "completed_at": "2025-05-29T02:24:58.114907Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002406597137451172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__organizations", "compiled": true, "compiled_code": "/* staging.stg_dailymed__organizations */\n\nwith xml_table as\n(\n\tselect zip_file, xml_content::xml as xml_column\n\tfrom sagerx_lake.dailymed\n)\n\nselect zip_file, y.*\n    from   xml_table x,\n            xmltable('/dailymed/Organizations/establishment'\n              passing xml_column\n              columns \n                document_id \ttext  path '../../documentId',\n\t\t\t\tset_id  \t\ttext  path '../../SetId',\n\t\t\t\tversion_number\t text  path '../../VersionNumber',\n\t\t\t\tdun\t\t\t\ttext  path './DUN',\n\t            org_name\t\ttext  path './name',\n\t            org_type\t\ttext  path './type'\n\t\t\t\t\t) y", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__organizations\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.116197Z", "completed_at": "2025-05-29T02:24:58.117706Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.117985Z", "completed_at": "2025-05-29T02:24:58.117989Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002404451370239258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__package_label_sections", "compiled": true, "compiled_code": "/* staging.stg_dailymed__package_label_sections */\n\nwith xml_table as\n(\n\tselect zip_file, xml_content::xml as xml_column\n\tfrom sagerx_lake.dailymed\n)\n\nselect\n\tzip_file\n\t, y.*\nfrom xml_table x,\n\txmltable(\n\t\t'//PackageLabel' passing xml_column\n\t\tcolumns \n\t\t\tdocument_id \ttext  path '../../documentId',\n\t\t\tset_id  \t\ttext  path '../../SetId',\n\t\t\tversion_number\ttext  path '../../VersionNumber',\n\t\t\tid\t\t\t\ttext  path 'ID',\n\t\t\ttext\t\t\ttext  path 'Text',\n\t\t\tmedia_list\t\txml   path 'MediaList'\n\t) y", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__package_label_sections\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.119270Z", "completed_at": "2025-05-29T02:24:58.122222Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.122503Z", "completed_at": "2025-05-29T02:24:58.122507Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003849506378173828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_enforcement__json_ndcs", "compiled": true, "compiled_code": "-- stg_fda_enforcement__json_ndcs.sql\n\nWITH base AS (\n\tselect\n\t\tfdae.recall_number\n\t\t, ndc.id_value #>> '{}' as ndc\n\t\t, app_num.id_value #>> '{}' as app_num\n\tfrom sagerx_lake.fda_enforcement fdae\n\t\t, json_array_elements(openfda->'package_ndc') with ordinality ndc(id_value, line)\n\t\t, json_array_elements(openfda->'application_number') with ordinality app_num(id_value, line)\n) \n\nselect\n\tfdae.recall_number\n\t, \n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndc\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndc,4) || REPLACE(RIGHT(ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndc,5) || '0' || REPLACE(RIGHT(ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndc,10),'-','') || '0' || RIGHT(ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11\n\t, left(\n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndc\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndc,4) || REPLACE(RIGHT(ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndc,5) || '0' || REPLACE(RIGHT(ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndc,10),'-','') || '0' || RIGHT(ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n,9) as ndc9\n\t, app_num\nfrom sagerx_lake.fda_enforcement fdae\n\t, json_array_elements(openfda->'package_ndc') with ordinality ndc(id_value, line)\n\t, json_array_elements(openfda->'application_number') with ordinality app_num(id_value, line)\nwhere \n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndc\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndc,4) || REPLACE(RIGHT(ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndc,5) || '0' || REPLACE(RIGHT(ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndc,10),'-','') || '0' || RIGHT(ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n is not null", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_enforcement__json_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.123796Z", "completed_at": "2025-05-29T02:24:58.126348Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.126623Z", "completed_at": "2025-05-29T02:24:58.126627Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003432750701904297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_enforcement__regex_ndcs", "compiled": true, "compiled_code": "-- stg_fda_enforcement__regex_ndcs.sql\n\n\nwith\n\nz_base as (\n\tselect\n\t\trecall_number\n\t\t, (regexp_matches(product_description, '(\\m\\d{1,5}-\\d{1,4}-\\d{1,2}\\M|\\m\\d{11}\\M)', 'g'))[1] as ndc\n\tfrom sagerx_lake.fda_enforcement\n),\nz as (\n\tselect \n\trecall_number\n\t, \n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndc\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndc,4) || REPLACE(RIGHT(ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndc,5) || '0' || REPLACE(RIGHT(ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndc,10),'-','') || '0' || RIGHT(ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11\n\t, left( \n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndc\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndc,4) || REPLACE(RIGHT(ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndc,5) || '0' || REPLACE(RIGHT(ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndc,10),'-','') || '0' || RIGHT(ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n, 9) as ndc9\n\tfrom z_base\n)\t\n\nselect\n\t*\nfrom z\nwhere ndc11 is not null", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_enforcement__regex_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.127907Z", "completed_at": "2025-05-29T02:24:58.130637Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.130911Z", "completed_at": "2025-05-29T02:24:58.130915Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003612041473388672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_enforcement__reports", "compiled": true, "compiled_code": "-- stg_fda_enforcement__reports.sql\n\nselect\n\tstatus\n\t, city\n\t, state\n\t, country\n\t, classification\n\t, openfda\n\t, product_type\n\t, event_id\n\t, recalling_firm\n\t, address_1\n\t, address_2\n\t, postal_code\n\t, voluntary_mandated\n\t, initial_firm_notification\n\t, distribution_pattern\n\t, recall_number\n\t, product_description\n\t, product_quantity\n\t, reason_for_recall\n\t, recall_initiation_date\n\t, center_classification_date\n\t, report_date\n\t, code_info\nfrom sagerx_lake.fda_enforcement", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_enforcement__reports\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.132200Z", "completed_at": "2025-05-29T02:24:58.134327Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.134603Z", "completed_at": "2025-05-29T02:24:58.134607Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0030164718627929688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_excluded__classes", "compiled": true, "compiled_code": "-- stg_fda_excluded__classes.sql\nwith\n\nproduct as (\n    select * from \"sagerx\".\"sagerx_lake\".\"fda_excluded_product\"\n)\n\n, pharm_classes_array as (\n\tselect \n\t\tproduct.productid\n\t\t, token\n\t\t, row_number() over (partition by product.productid order by token desc) as class_line\n\tfrom product, unnest(string_to_array(product.pharm_classes, ',')) as token\n)\n\nselect\n\tclasses.productid\n\t, classes.class_line\n\t, trim(left(classes.token, position('[' in classes.token) -1 )) as class_name\n\t, substring(classes.token, '\\[(.+)\\]') as class_type\nfrom pharm_classes_array classes\norder by\n\tproductid\n\t, class_line", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_excluded__classes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.135883Z", "completed_at": "2025-05-29T02:24:58.138764Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.139041Z", "completed_at": "2025-05-29T02:24:58.139045Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037729740142822266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_excluded__ndcs", "compiled": true, "compiled_code": "-- stg_fda_excluded__ndcs.sql\n\nwith\n\nproduct as (\n    \n    select * from \"sagerx\".\"sagerx_lake\".\"fda_excluded_product\"\n\n),\n\npackage as (\n\n    select * from \"sagerx\".\"sagerx_lake\".\"fda_excluded_package\"\n\n)\n\nselect\n\t\n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndcpackagecode\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndcpackagecode,4) || REPLACE(RIGHT(ndcpackagecode,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndcpackagecode,5) || '0' || REPLACE(RIGHT(ndcpackagecode,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndcpackagecode,10),'-','') || '0' || RIGHT(ndcpackagecode, 1)\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndcpackagecode,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11\n\t, package.productid\n\t, package.productndc\n\t, producttypename\n\t, proprietaryname\n\t, proprietarynamesuffix\n\t, nonproprietaryname\n\t, dosageformname\n\t, routename\n\t, product.startmarketingdate as product_startmarketingdate\n\t, product.endmarketingdate as product_endmarketingdate\n\t, marketingcategoryname\n\t, applicationnumber\n\t, labelername\n\t, substancename\n\t, active_numerator_strength\n\t, active_ingred_unit\n\t, pharm_classes\n\t, deaschedule\n\t, product.ndc_exclude_flag as product_ndc_exclude_flag\n\t, listing_record_certified_through\n\t, ndcpackagecode\n\t, packagedescription\n\t, package.startmarketingdate as package_startmarketingdate\n\t, package.endmarketingdate as package_endmarketingdate\n\t, package.ndc_exclude_flag as package_ndc_exclude_flag\n\t, sample_package\nfrom package\nleft join product\n\ton package.productid = product.productid", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_excluded__ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.140352Z", "completed_at": "2025-05-29T02:24:58.142548Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.142821Z", "completed_at": "2025-05-29T02:24:58.142825Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0031044483184814453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_excluded__substances", "compiled": true, "compiled_code": "-- stg_fda_excluded__substances.sql\n\nwith\n\nproduct as (    \n    select * from \"sagerx\".\"sagerx_lake\".\"fda_excluded_product\"\n)\n\n, substancename_array as (\n\tselect\n\t\tproductid\n\t\t, substance\n\t\t, row_number() over(partition by productid) as substance_line\n\tfrom product, unnest(string_to_array(substancename, '; ')) as substance\n)\n\n, strength_array as (\n\tselect\n\t\tproductid\n\t\t, strength\n\t\t, row_number() over(partition by productid) as strength_line\n\tfrom product, unnest(string_to_array(active_numerator_strength, '; ')) as strength\n)\n\n, unit_array as (\n\tselect\n\t\tproductid\n\t\t, unit\n\t\t, row_number() over(partition by productid) as unit_line\n\tfrom product, unnest(string_to_array(active_ingred_unit, '; ')) as unit\n)\n\nselect\n\tsubstance.productid\n\t, substance.substance_line\n\t, substance.substance as substancename\n\t, strength.strength as active_numerator_strength\n\t, unit.unit as active_ingred_unit\nfrom substancename_array substance\ninner join strength_array strength\n\ton strength.productid = substance.productid\n\tand strength.strength_line = substance.substance_line\ninner join unit_array unit\n\ton unit.productid = substance.productid\n\tand unit.unit_line = substance.substance_line\norder by\n\tproductid\n\t, substance_line", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_excluded__substances\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.144121Z", "completed_at": "2025-05-29T02:24:58.146350Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.146626Z", "completed_at": "2025-05-29T02:24:58.146630Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003122568130493164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_ndc__classes", "compiled": true, "compiled_code": "-- stg_fda_ndc__classes.sql\n\nwith\n\nproduct as (    \n    select * from \"sagerx\".\"sagerx_lake\".\"fda_ndc_product\"\n)\n\n, pharm_classes_array as (\n\tselect \n\t\tproduct.productid\n\t\t, token\n\t\t, row_number() over (partition by product.productid order by token desc) as class_line\n\tfrom product, unnest(string_to_array(product.pharm_classes, ',')) as token\n)\n\nselect\n\tclasses.productid\n\t, classes.class_line\n\t, trim(left(classes.token, position('[' in classes.token) -1 )) as class_name\n\t, substring(classes.token, '\\[(.+)\\]') as class_type\nfrom pharm_classes_array classes\norder by\n\tproductid\n\t, class_line", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__classes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.147909Z", "completed_at": "2025-05-29T02:24:58.150705Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.150987Z", "completed_at": "2025-05-29T02:24:58.150991Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0036818981170654297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_ndc__ndc_associations", "compiled": true, "compiled_code": "-- stg_fda_ndc__ndc_associations\n\nwith package as (\n\n    select * \n    from \"sagerx\".\"sagerx_lake\".\"fda_ndc_package\"\n\n),\n\nextracted_ndc as (\n\n    select \n        package.ndcpackagecode,\n        regexp_matches(package.packagedescription, '\\d+-\\d+-\\d+', 'g') as ndc_match,\n\t\tpackagedescription\n    from package\n\n),\n\nndc_array as (\n\n    select \n        ndc.ndcpackagecode,\n        unnest(ndc.ndc_match) as token,\n\t\tpackagedescription\n    from extracted_ndc ndc\n\n),\n\nranked_array as (\n\t\n\tselect\n\t\tndcpackagecode,\n\t\ttoken,\n\t\trow_number() over() as rn,\n\t\tpackagedescription\n\tfrom ndc_array\n\n),\n\nfinal_array as (\n\n    select\n        ndcpackagecode,\n        token,\n        row_number() over (partition by ndcpackagecode order by rn) as ndc_line,\n\t\tpackagedescription\n    from ranked_array\n\n),\n\nndc_associations as (\n\n    select\n        ndcpackagecode as outer_ndc,\n        \n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndcpackagecode\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndcpackagecode,4) || REPLACE(RIGHT(ndcpackagecode,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndcpackagecode,5) || '0' || REPLACE(RIGHT(ndcpackagecode,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndcpackagecode,10),'-','') || '0' || RIGHT(ndcpackagecode, 1)\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndcpackagecode,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as outer_ndc11,\n        ndc_line,\n        token as ndc,\n        \n  \n  CASE WHEN \n  \n  \n    CASE WHEN token ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN token ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN token ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN token ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN token ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN token ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN token ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN token ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN token ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN token ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN token ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN token ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN token\n     WHEN \n  \n  \n    CASE WHEN token ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN token ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN token ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN token ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN token ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN token ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(token,4) || REPLACE(RIGHT(token,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN token ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN token ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN token ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN token ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN token ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN token ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(token,5) || '0' || REPLACE(RIGHT(token,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN token ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN token ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN token ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN token ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN token ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN token ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(token,10),'-','') || '0' || RIGHT(token, 1)\n     WHEN \n  \n  \n    CASE WHEN token ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN token ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN token ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN token ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN token ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN token ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(token,'-','')\n     WHEN \n  \n  \n    CASE WHEN token ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN token ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN token ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN token ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN token ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN token ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN token ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN token ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN token ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN token ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN token ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN token ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN token ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11,\n        packagedescription\n    from final_array\n    order by\n        ndcpackagecode,\n        ndc_line\n\n)\n\nselect * from ndc_associations", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndc_associations\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.152286Z", "completed_at": "2025-05-29T02:24:58.155098Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.155375Z", "completed_at": "2025-05-29T02:24:58.155379Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037069320678710938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_ndc__ndcs", "compiled": true, "compiled_code": "-- stg_fda_ndc__ndcs.sql\n\nwith\n\nproduct as (\n    \n    select * from \"sagerx\".\"sagerx_lake\".\"fda_ndc_product\"\n\n),\n\npackage as (\n\n    select * from \"sagerx\".\"sagerx_lake\".\"fda_ndc_package\"\n\n)\n\nselect\n\t\n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndcpackagecode\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndcpackagecode,4) || REPLACE(RIGHT(ndcpackagecode,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndcpackagecode,5) || '0' || REPLACE(RIGHT(ndcpackagecode,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndcpackagecode,10),'-','') || '0' || RIGHT(ndcpackagecode, 1)\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndcpackagecode,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11\n\t, package.productid\n\t, package.productndc\n\t, producttypename\n\t, proprietaryname\n\t, proprietarynamesuffix\n\t, nonproprietaryname\n\t, dosageformname\n\t, routename\n\t, product.startmarketingdate as product_startmarketingdate\n\t, product.endmarketingdate as product_endmarketingdate\n\t, marketingcategoryname\n\t, applicationnumber\n\t, labelername\n\t, substancename\n\t, active_numerator_strength\n\t, active_ingred_unit\n\t, pharm_classes\n\t, deaschedule\n\t, product.ndc_exclude_flag as product_ndc_exclude_flag\n\t, listing_record_certified_through\n\t, ndcpackagecode\n\t, packagedescription\n\t, package.startmarketingdate as package_startmarketingdate\n\t, package.endmarketingdate as package_endmarketingdate\n\t, package.ndc_exclude_flag as package_ndc_exclude_flag\n\t, sample_package\nfrom package\nleft join product\n\ton package.productid = product.productid", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.156650Z", "completed_at": "2025-05-29T02:24:58.158899Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.159179Z", "completed_at": "2025-05-29T02:24:58.159183Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003133058547973633, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_ndc__substances", "compiled": true, "compiled_code": "-- stg_fda_ndc__substances.sql\n\nwith\n\nproduct as (\n    select * from \"sagerx\".\"sagerx_lake\".\"fda_ndc_product\"\n)\n\n, substancename_array as (\n\tselect\n\t\tproductid\n\t\t, substance\n\t\t, row_number() over(partition by productid) as substance_line\n\tfrom product, unnest(string_to_array(substancename, '; ')) as substance\n)\n\n, strength_array as (\n\tselect\n\t\tproductid\n\t\t, strength\n\t\t, row_number() over(partition by productid) as strength_line\n\tfrom product, unnest(string_to_array(active_numerator_strength, '; ')) as strength\n)\n\n, unit_array as (\n\tselect\n\t\tproductid\n\t\t, unit\n\t\t, row_number() over(partition by productid) as unit_line\n\tfrom product, unnest(string_to_array(active_ingred_unit, '; ')) as unit\n)\n\nselect\n\tsubstance.productid\n\t, substance.substance_line\n\t, substance.substance as substancename\n\t, strength.strength as active_numerator_strength\n\t, unit.unit as active_ingred_unit\nfrom substancename_array substance\ninner join strength_array strength\n\ton strength.productid = substance.productid\n\tand strength.strength_line = substance.substance_line\ninner join unit_array unit\n\ton unit.productid = substance.productid\n\tand unit.unit_line = substance.substance_line\norder by\n\tproductid\n\t, substance_line", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__substances\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.160467Z", "completed_at": "2025-05-29T02:24:58.163361Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.163640Z", "completed_at": "2025-05-29T02:24:58.163645Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003792285919189453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_unfinished__ndcs", "compiled": true, "compiled_code": "-- stg_fda_unfinished__ndcs.sql\n\nwith\n\nproduct as (\n    \n    select * from \"sagerx\".\"sagerx_lake\".\"fda_unfinished_product\"\n\n),\n\npackage as (\n\n    select * from \"sagerx\".\"sagerx_lake\".\"fda_unfinished_package\"\n\n)\n\nselect\n\t\n  \n  CASE WHEN \n  \n  \n    CASE WHEN package.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN package.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN package.ndcpackagecode\n     WHEN \n  \n  \n    CASE WHEN package.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(package.ndcpackagecode,4) || REPLACE(RIGHT(package.ndcpackagecode,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN package.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(package.ndcpackagecode,5) || '0' || REPLACE(RIGHT(package.ndcpackagecode,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN package.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(package.ndcpackagecode,10),'-','') || '0' || RIGHT(package.ndcpackagecode, 1)\n     WHEN \n  \n  \n    CASE WHEN package.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(package.ndcpackagecode,'-','')\n     WHEN \n  \n  \n    CASE WHEN package.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN package.ndcpackagecode ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN package.ndcpackagecode ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN package.ndcpackagecode ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11\n\t, package.productid\n\t, package.productndc\n\t, producttypename\n\t, nonproprietaryname\n\t, dosageformname\n\t, product.startmarketingdate as product_startmarketingdate\n\t, product.endmarketingdate as product_endmarketingdate\n\t, marketingcategoryname\n\t, labelername\n\t, substancename\n\t, active_numerator_strength\n\t, active_ingred_unit\n\t, deaschedule\n\t, listing_record_certified_through\n\t, ndcpackagecode\n\t, packagedescription\n\t, package.startmarketingdate as package_startmarketingdate\n\t, package.endmarketingdate as package_endmarketingdate\nfrom package\nleft join product\n\ton package.productid = product.productid", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_unfinished__ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.164942Z", "completed_at": "2025-05-29T02:24:58.167278Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.167556Z", "completed_at": "2025-05-29T02:24:58.167560Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00323486328125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_unfinished__substances", "compiled": true, "compiled_code": "-- stg_fda_unfinished__substances.sql\n\nwith\n\nproduct as (    \n    select * from \"sagerx\".\"sagerx_lake\".\"fda_unfinished_product\"\n)\n\n, substancename_array as (\n\tselect\n\t\tproductid\n\t\t, substance\n\t\t, row_number() over(partition by productid) as substance_line\n\tfrom product, unnest(string_to_array(substancename, '; ')) as substance\n)\n\n, strength_array as (\n\tselect\n\t\tproductid\n\t\t, strength\n\t\t, row_number() over(partition by productid) as strength_line\n\tfrom product, unnest(string_to_array(active_numerator_strength, '; ')) as strength\n)\n\n, unit_array as (\n\tselect\n\t\tproductid\n\t\t, unit\n\t\t, row_number() over(partition by productid) as unit_line\n\tfrom product, unnest(string_to_array(active_ingred_unit, '; ')) as unit\n)\n\nselect\n\tsubstance.productid\n\t, substance.substance_line\n\t, substance.substance as substancename\n\t, strength.strength as active_numerator_strength\n\t, unit.unit as active_ingred_unit\nfrom substancename_array substance\ninner join strength_array strength\n\ton strength.productid = substance.productid\n\tand strength.strength_line = substance.substance_line\ninner join unit_array unit\n\ton unit.productid = substance.productid\n\tand unit.unit_line = substance.substance_line\norder by\n\tproductid\n\t, substance_line", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_unfinished__substances\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.168841Z", "completed_at": "2025-05-29T02:24:58.170982Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.171264Z", "completed_at": "2025-05-29T02:24:58.171268Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0030264854431152344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_fda_unii__unii_codes", "compiled": true, "compiled_code": "-- stg_fda_unii__unii_codes.sql\n\nwith\n\nfda_unii as (\n    select * from \"sagerx\".\"sagerx_lake\".\"fda_unii\"\n)\n\nselect\n    unii\n    , display_name\n    , rxcui\n    , pubchem\n    , rn\n    , ncit\n    , ncbi\n    , dailymed\nfrom fda_unii", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_fda_unii__unii_codes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.172548Z", "completed_at": "2025-05-29T02:24:58.174743Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.175017Z", "completed_at": "2025-05-29T02:24:58.175022Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0030934810638427734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_nadac__nadac", "compiled": true, "compiled_code": "-- stg_nadac__nadac.sql\n\nwith\n\nnadac as (\n\n    select distinct \n\t\tndc_description,\n\t\tndc,\n\t\tnadac_per_unit::numeric,\n\t\teffective_date::date,\n\t\tpricing_unit,\n\t\tpharmacy_type_indicator,\n\t\totc,\n\t\texplanation_code,\n\t\tclassification_for_rate_setting,\n\t\tcorresponding_generic_drug_nadac_per_unit,\n\t\tcorresponding_generic_drug_effective_date::date,\n\t\tas_of_date::date\n\tfrom \"sagerx\".\"sagerx_lake\".\"nadac\"\n\n)\n\nselect * from nadac", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_nadac__nadac\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.176310Z", "completed_at": "2025-05-29T02:24:58.179788Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.180061Z", "completed_at": "2025-05-29T02:24:58.180065Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004374265670776367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxclass__rxclass", "compiled": true, "compiled_code": "-- stg_rxclass__rxclass.sql\n\nwith rxclass as (\n    \n    select\n        *\n    from \"sagerx\".\"sagerx_lake\".\"rxclass\"\n\n)\n\nselect distinct\n    *\nfrom rxclass", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxclass__rxclass\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.181481Z", "completed_at": "2025-05-29T02:24:58.183644Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.183920Z", "completed_at": "2025-05-29T02:24:58.183924Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003172636032104492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__all_ndcs", "compiled": true, "compiled_code": "-- stg_rxnorm__all_ndcs.sql\n\nselect\n   \n  \n  CASE WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN rxnsat.atv\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(rxnsat.atv,4) || REPLACE(RIGHT(rxnsat.atv,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(rxnsat.atv,5) || '0' || REPLACE(RIGHT(rxnsat.atv,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(rxnsat.atv,10),'-','') || '0' || RIGHT(rxnsat.atv, 1)\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(rxnsat.atv,'-','')\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \nas ndc11\n    , rxnsat.atv as ndc\n    , rxnsat.rxcui\n    , rxnsat.sab\n\t, case when rxnsat.suppress = 'N' then true else false end as active\n\t, case when rxnsat.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnsat rxnsat\n    where rxnsat.atn = 'NDC'\n\tand rxnsat.sab in ('ATC', 'CVX', 'DRUGBANK', 'MSH', 'MTHCMSFRF', 'MTHSPL', 'RXNORM', 'USP', 'VANDF')", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__all_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.185212Z", "completed_at": "2025-05-29T02:24:58.186756Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.187028Z", "completed_at": "2025-05-29T02:24:58.187032Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0024399757385253906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__atc_codes", "compiled": true, "compiled_code": "with atc as (\n\tselect distinct a.rxcui\n\t\t,a.code\n\t\t,b.atn\n\t\t,b.atv as atc_class_level\n\t\t,a.str as description\n\t\t,a.sab\n\t\t,a.tty\n\tfrom (\n\t\tselect *\n\t\tfrom sagerx_lake.rxnorm_rxnconso\n\t\twhere sab = 'ATC'\n\t\tand tty not like 'RXN%'\n\t\torder by code\n\t) a\n\tleft join sagerx_lake.rxnorm_rxnsat b\n\t\ton a.code= b.code\n\twhere atn = 'ATC_LEVEL'\n\torder by code\n)\n\n, atc_5 as (\n\tselect\n\t\t*\n\tfrom atc\n\twhere atc_class_level = '5'\n)\n\n, atc_4 as (\n\tselect\n\t\t*\n\tfrom atc\n\twhere atc_class_level = '4'\n)\n\n, atc_3 as (\n\tselect\n\t\t*\n\tfrom atc\n\twhere atc_class_level = '3'\n)\n\n, atc_2 as (\n\tselect\n\t\t*\n\tfrom atc\n\twhere atc_class_level = '2'\n)\n\n, atc_1 as (\n\tselect\n\t\t*\n\tfrom atc\n\twhere atc_class_level = '1'\n)\n\n, sagerx_atc as (\n\nselect\n\tatc_1.code as atc_1_code\n\t, atc_1.description as atc_1_name\n\t, atc_2.code as atc_2_code\n\t, atc_2.description as atc_2_name\n\t, atc_3.code as atc_3_code\n\t, atc_3.description as atc_3_name\n\t, atc_4.code as atc_4_code\n\t, atc_4.description as atc_4_name\n\t, atc_5.code as atc_5_code\n\t, atc_5.description as atc_5_name\n\t, atc_5.rxcui as ingredient_rxcui\n\t, atc_5.description as ingredient_name\n\t, atc_5.tty as ingredient_tty\n\nfrom atc_5\nleft join atc_4\n\ton left(atc_5.code, 5) = atc_4.code\nleft join atc_3\n\ton left(atc_4.code, 4) = atc_3.code\nleft join atc_2\n\ton left(atc_3.code, 3) = atc_2.code\nleft join atc_1\n\ton left(atc_2.code, 1) = atc_1.code\n)\n\t\nselect * \nfrom sagerx_atc", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__atc_codes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.188330Z", "completed_at": "2025-05-29T02:24:58.189901Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.190189Z", "completed_at": "2025-05-29T02:24:58.190194Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0024809837341308594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__brand_product_component_links", "compiled": true, "compiled_code": "-- stg_rxnorm__brand_product_component_links.sql\n\nselect distinct\n\tproduct.rxcui as brand_product_rxcui\n\t, case when product_component.rxcui is null\n        then product.rxcui\n        else product_component.rxcui\n        end as brand_product_component_rxcui\nfrom sagerx_lake.rxnorm_rxnconso product\nleft join sagerx_lake.rxnorm_rxnrel rxnrel on rxnrel.rxcui2 = product.rxcui and rxnrel.rela = 'contains'\nleft join sagerx_lake.rxnorm_rxnconso product_component\n\ton rxnrel.rxcui1 = product_component.rxcui\n\tand product_component.tty in ('SBD', 'SCD') -- NOTE: BPCKs can contain SBDs AND SCDs\n\tand product_component.sab = 'RXNORM'\nwhere product.tty in ('SBD', 'BPCK')\n\tand product.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_product_component_links\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.191482Z", "completed_at": "2025-05-29T02:24:58.193064Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.193348Z", "completed_at": "2025-05-29T02:24:58.193353Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002485036849975586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__brand_product_components", "compiled": true, "compiled_code": "-- stg_rxnorm__brand_product_components.sql\n\nselect distinct\n\tcase when product.tty = 'SBD' then product.rxcui else product_component.rxcui end rxcui\n\t, case when product.tty = 'SBD' then product.str else product_component.str end name\n\t, case when product.tty = 'SBD' then product.tty else product_component.tty end tty\n\t, case when product_component.tty = 'SCD' then product_component.rxcui else rxnrel_scd.rxcui1 end clinical_product_component_rxcui\n\t, rxnrel_bn.rxcui1 as brand_rxcui\n\t, case when \n            case when product.tty = 'SBD'\n            then product.suppress\n            else product_component.suppress\n            end = 'N' \n        then true \n        else false\n        end as active\n\t, case when \n            case when product.tty = 'SBD'\n            then product.cvf\n            else product_component.cvf \n            end = '4096' \n        then true\n        else false\n        end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso product\nleft join sagerx_lake.rxnorm_rxnrel rxnrel on rxnrel.rxcui2 = product.rxcui and rxnrel.rela = 'contains'\nleft join sagerx_lake.rxnorm_rxnconso product_component\n\ton rxnrel.rxcui1 = product_component.rxcui\n\tand product_component.tty in ('SBD', 'SCD') -- NOTE: BPCKs can contain SBDs AND SCDs\n\tand product_component.sab = 'RXNORM'\nleft join sagerx_lake.rxnorm_rxnrel rxnrel_scd \n\ton rxnrel_scd.rxcui2 = case when product_component.rxcui is null then product.rxcui else product_component.rxcui end \n\tand rxnrel_scd.rela = 'tradename_of' -- rxnrel_scd.rxcui1 = clinical_product_component_rxcui\nleft join sagerx_lake.rxnorm_rxnrel rxnrel_bn \n\ton rxnrel_bn.rxcui2 = case when product_component.rxcui is null then product.rxcui else product_component.rxcui end \n\tand rxnrel_bn.rela = 'has_ingredient' -- rxnrel_bn.rxcui1 = brand_rxcui\nwhere product.tty in ('SBD', 'BPCK')\n\tand product.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_product_components\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.194737Z", "completed_at": "2025-05-29T02:24:58.196343Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.196617Z", "completed_at": "2025-05-29T02:24:58.196621Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002493143081665039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__brand_products", "compiled": true, "compiled_code": "-- stg_rxnorm__brand_products.sql\n\nselect\n\tproduct.rxcui as rxcui\n\t, product.str as name\n\t, product.tty as tty\n\t, clinical_product.rxcui as clinical_product_rxcui\n\t, case when product.suppress = 'N' then true else false end as active\n\t, case when product.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso product\nleft join sagerx_lake.rxnorm_rxnrel rxnrel on rxnrel.rxcui2 = product.rxcui and rxnrel.rela = 'tradename_of'\nleft join sagerx_lake.rxnorm_rxnconso clinical_product\n\ton rxnrel.rxcui1 = clinical_product.rxcui\n\tand clinical_product.tty in ('SCD', 'GPCK')\n\tand clinical_product.sab = 'RXNORM'\nwhere product.tty in('SBD', 'BPCK')\n\tand product.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_products\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.197933Z", "completed_at": "2025-05-29T02:24:58.199491Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.199760Z", "completed_at": "2025-05-29T02:24:58.199765Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0024323463439941406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__brands", "compiled": true, "compiled_code": "-- stg_rxnorm__brands.sql\n\nwith cte as (\n\tselect\n\t\tsq.*\n\t\t, row_number() over(partition by rxcui order by ingredient_tty desc) as rn\n\tfrom (\n\n\t\tselect\n\t\t\tbrand.rxcui as rxcui\n\t\t\t, brand.str as name\n\t\t\t, brand.tty as tty\n\t\t\t, ingredient.rxcui as ingredient_rxcui\n\t\t\t, ingredient.str as ingredient_name\n\t\t\t, ingredient.tty as ingredient_tty\n\t\tfrom sagerx_lake.rxnorm_rxnconso brand\n\t\tinner join sagerx_lake.rxnorm_rxnrel rxnrel on rxnrel.rxcui2 = brand.rxcui and rxnrel.rela = 'tradename_of'\n\t\tinner join sagerx_lake.rxnorm_rxnconso ingredient\n\t\t\ton rxnrel.rxcui1 = ingredient.rxcui\n\t\t\tand ingredient.tty = 'IN'\n\t\t\tand ingredient.sab = 'RXNORM'\n\t\twhere brand.tty = 'BN'\n\t\t\tand brand.sab = 'RXNORM'\n\n\t\tunion all\n\n\t\tselect\n\t\t\tbrand.rxcui as rxcui\n\t\t\t, brand.str as name\n\t\t\t, brand.tty as tty\n\t\t\t, ingredient.rxcui as ingredient_rxcui\n\t\t\t, ingredient.str as ingredient_name\n\t\t\t, ingredient.tty as ingredient_tty\n\t\tfrom sagerx_lake.rxnorm_rxnconso brand\n\t\tinner join sagerx_lake.rxnorm_rxnrel sbd_rxnrel on sbd_rxnrel.rxcui2 = brand.rxcui and sbd_rxnrel.rela = 'ingredient_of'\n\t\tinner join sagerx_lake.rxnorm_rxnrel scd_rxnrel on scd_rxnrel.rxcui2 = sbd_rxnrel.rxcui1 and scd_rxnrel.rela = 'tradename_of'\n\t\tinner join sagerx_lake.rxnorm_rxnrel ingredient_rxnrel on ingredient_rxnrel.rxcui2 = scd_rxnrel.rxcui1 and ingredient_rxnrel.rela = 'has_ingredients'\n\t\tleft join sagerx_lake.rxnorm_rxnconso ingredient\n\t\t\ton ingredient_rxnrel.rxcui1 = ingredient.rxcui\n\t\t\tand ingredient.tty = 'MIN'\n\t\t\tand ingredient.sab = 'RXNORM'\t\t\n\t\twhere brand.tty = 'BN'\n\t\t\tand brand.sab = 'RXNORM'\n\t) sq\n)\n\nselect distinct\n\tbrand.rxcui as rxcui\n\t, brand.str as name\n\t, brand.tty as tty\n\t, case when brand.suppress = 'N' then true else false end as active\n\t, case when brand.cvf = '4096' then true else false end as prescribable\n\t, cte.ingredient_rxcui as ingredient_rxcui\nfrom sagerx_lake.rxnorm_rxnconso product\ninner join sagerx_lake.rxnorm_rxnrel rxnrel on rxnrel.rxcui2 = product.rxcui and rxnrel.rela = 'has_ingredient'\ninner join sagerx_lake.rxnorm_rxnconso brand\n\ton rxnrel.rxcui1 = brand.rxcui\n\tand brand.tty = 'BN'\n\tand brand.sab = 'RXNORM'\nLeft join cte on cte.rxcui = brand.rxcui and cte.rn < 2\nwhere product.tty = 'SBD'\n\tand product.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brands\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.201048Z", "completed_at": "2025-05-29T02:24:58.202595Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.202868Z", "completed_at": "2025-05-29T02:24:58.202872Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0024297237396240234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__clinical_product_component_links", "compiled": true, "compiled_code": "-- stg_rxnorm__clinical_product_component_links.sql\n\nselect distinct\n\tproduct.rxcui as clinical_product_rxcui\n\t, case when product_component.rxcui is null\n        then product.rxcui \n        else product_component.rxcui \n        end as clinical_product_component_rxcui\nfrom sagerx_lake.rxnorm_rxnconso product\nleft join sagerx_lake.rxnorm_rxnrel rxnrel on rxnrel.rxcui2 = product.rxcui and rxnrel.rela = 'contains'\nleft join sagerx_lake.rxnorm_rxnconso product_component\n    on rxnrel.rxcui1 = product_component.rxcui\n    and product_component.tty = 'SCD'\n    and product_component.sab = 'RXNORM'\nwhere product.tty in('SCD', 'GPCK')\n\tand product.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.204168Z", "completed_at": "2025-05-29T02:24:58.205858Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.206145Z", "completed_at": "2025-05-29T02:24:58.206149Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002594470977783203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__clinical_product_components", "compiled": true, "compiled_code": "-- stg_rxnorm__clinical_product_components.sql\n\nwith cte as (\n\tselect\n\tsq.*,\n\trow_number() over(partition by product_component_rxcui order by ingredient_tty desc) as rn\n\tfrom (\n\t\tselect\n\t\t\tproduct_component.rxcui as product_component_rxcui\n\t\t\t, product_component.str as product_component_name\n\t\t\t, product_component.tty as product_component_tty\n\t\t\t, ingredient.rxcui as ingredient_rxcui\n\t\t\t, ingredient.str as ingredient_name\n\t\t\t, ingredient.tty as ingredient_tty\n\t\tfrom sagerx_lake.rxnorm_rxnconso product_component\n\t\tinner join sagerx_lake.rxnorm_rxnrel rxnrel\n\t\t\ton rxnrel.rxcui2 = product_component.rxcui and rxnrel.rela = 'has_ingredients'\n\t\tinner join sagerx_lake.rxnorm_rxnconso ingredient\n\t\t\ton rxnrel.rxcui1 = ingredient.rxcui\n\t\t\tand ingredient.tty = 'MIN'\n\t\t\tand ingredient.sab = 'RXNORM'\n\t\twhere product_component.tty = 'SCD'\n\t\t\tand product_component.sab = 'RXNORM'\n\n\t\tunion all\n\n\t\tselect\n\t\t\tproduct_component.rxcui as product_component_rxcui\n\t\t\t, product_component.str as product_component_name\n\t\t\t, product_component.tty as product_component_tty\n\t\t\t, ingredient.rxcui as ingredient_rxcui\n\t\t\t, ingredient.str as ingredient_name\n\t\t\t, ingredient.tty as ingredient_tty\n\t\tfrom sagerx_lake.rxnorm_rxnconso product_component\n\t\tinner join sagerx_lake.rxnorm_rxnrel scdc_rxnrel\n\t\t\ton scdc_rxnrel.rxcui2 = product_component.rxcui and scdc_rxnrel.rela = 'consists_of'\n\t\tinner join sagerx_lake.rxnorm_rxnconso scdc\n\t\t\ton scdc_rxnrel.rxcui1 = scdc.rxcui\n\t\tinner join sagerx_lake.rxnorm_rxnrel ingredient_rxnrel\n\t\t\ton ingredient_rxnrel.rxcui2 = scdc.rxcui and ingredient_rxnrel.rela = 'has_ingredient'\n\t\tinner join sagerx_lake.rxnorm_rxnconso ingredient\n\t\t\ton ingredient_rxnrel.rxcui1 = ingredient.rxcui\n\t\t\tand ingredient.tty = 'IN'\n\t\t\tand ingredient.sab = 'RXNORM'\n\t\twhere product_component.tty = 'SCD'\n\t\t\tand product_component.sab = 'RXNORM'\n\t) sq\n)\n\nselect distinct\n\tcase when product_component.rxcui is null then product.rxcui else product_component.rxcui end rxcui\n\t, case when product_component.str is null then product.str else product_component.str end name \n\t, case when product_component.tty is null then product.tty else product_component.tty end tty\n\t, case when \n\t\tcase when product_component.rxcui is null then product.suppress else product_component.suppress end = 'N' then true else false end as active\n\t, case when \n\t\tcase when product_component.rxcui is null then product.cvf else product_component.cvf end = '4096' then true else false end as prescribable\n\t, cte.ingredient_rxcui as ingredient_rxcui\n\t, dose_form_rxnrel.rxcui1 as dose_form_rxcui\nfrom sagerx_lake.rxnorm_rxnconso product\nleft join sagerx_lake.rxnorm_rxnrel rxnrel on rxnrel.rxcui2 = product.rxcui and rxnrel.rela = 'contains'\nleft join sagerx_lake.rxnorm_rxnconso product_component\n\ton rxnrel.rxcui1 = product_component.rxcui\n    and product_component.tty = 'SCD'\n    and product_component.sab = 'RXNORM'\nleft join cte \n\ton cte.product_component_rxcui = case when product_component.rxcui is null then product.rxcui else product_component.rxcui end\n\tand cte.rn < 2\nleft join sagerx_lake.rxnorm_rxnrel dose_form_rxnrel\n\ton dose_form_rxnrel.rxcui2 = case when product_component.rxcui is null then product.rxcui else product_component.rxcui end\n\tand dose_form_rxnrel.rela = 'has_dose_form'\n\tand dose_form_rxnrel.sab = 'RXNORM'\nwhere product.tty in('SCD', 'GPCK')\n\tand product.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.207421Z", "completed_at": "2025-05-29T02:24:58.208976Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.209258Z", "completed_at": "2025-05-29T02:24:58.209263Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002448558807373047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__clinical_products", "compiled": true, "compiled_code": "-- stg_rxnorm__clinical_products.sql\n\nselect\n\tproduct.rxcui as rxcui\n\t, product.str as name\n\t, product.tty as tty\n\t, case when product.suppress = 'N' then true else false end as active\n\t, case when product.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso product\nwhere product.tty in('SCD', 'GPCK')\n\tand product.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.210540Z", "completed_at": "2025-05-29T02:24:58.212211Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.212483Z", "completed_at": "2025-05-29T02:24:58.212488Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002562999725341797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__dose_form_group_links", "compiled": true, "compiled_code": "-- stg_rxnorm__dose_form_group_links.sql\n\nselect distinct\n\tdose_form.rxcui dose_form_rxcui\n\t, rxnrel.rxcui1 dose_form_group_rxcui\nfrom sagerx_lake.rxnorm_rxnconso dose_form\ninner join sagerx_lake.rxnorm_rxnrel rxnrel\n\ton rxnrel.rxcui2 = dose_form.rxcui\n\tand rxnrel.rela = 'isa'\n\tand rxnrel.sab = 'RXNORM'\nwhere dose_form.tty = 'DF'\n\tand dose_form.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_form_group_links\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.213763Z", "completed_at": "2025-05-29T02:24:58.215243Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.215518Z", "completed_at": "2025-05-29T02:24:58.215522Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002359628677368164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__dose_form_groups", "compiled": true, "compiled_code": "-- stg_rxnorm__dose_form_groups.sql\n\nselect\n\tdose_form_group.rxcui rxcui\n\t, dose_form_group.str name\n\t, dose_form_group.tty tty\n\t, case when dose_form_group.suppress = 'N' then true else false end as active\n\t, case when dose_form_group.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso dose_form_group\nwhere dose_form_group.tty = 'DFG'\n\tand dose_form_group.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_form_groups\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.216798Z", "completed_at": "2025-05-29T02:24:58.218389Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.218677Z", "completed_at": "2025-05-29T02:24:58.218681Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0024881362915039062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__dose_forms", "compiled": true, "compiled_code": "-- stg_rxnorm__dose_forms.sql\n\nselect\n\tdose_form.rxcui rxcui\n\t, dose_form.str name\n\t, dose_form.tty tty\n\t, case when dose_form.suppress = 'N' then true else false end as active\n\t, case when dose_form.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso dose_form\nwhere dose_form.tty = 'DF'\n\tand dose_form.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_forms\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.219947Z", "completed_at": "2025-05-29T02:24:58.222964Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.223257Z", "completed_at": "2025-05-29T02:24:58.223261Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003910541534423828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__hcpcs_codes", "compiled": true, "compiled_code": "select distinct \n    b.rxcui, \n    a.atv as hcpcs_code, \n    b.tty, \n    b.str as drug_name\nfrom sagerx_lake.rxnorm_rxnsat a\njoin sagerx_lake.rxnorm_rxnconso b on a.rxcui = b.rxcui\nwhere a.atn = 'DHJC'\nand a.atv like 'J%'\nand b.tty in ('GPCK', 'BPCK', 'SCD', 'SBD')\norder by a.atv", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__hcpcs_codes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.224575Z", "completed_at": "2025-05-29T02:24:58.226047Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.226329Z", "completed_at": "2025-05-29T02:24:58.226334Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0024030208587646484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__ingredient_component_links", "compiled": true, "compiled_code": "-- stg_rxnorm__ingredient_component_links.sql\n\nwith cte as (\n\tselect\n\t\trxnrel.rxcui2 as ingredient_rxcui\n\t\t, ingredient_component.rxcui as ingredient_component_rxcui\n\t\t, ingredient_component.str as ingredient_component_name\n\t\t, ingredient_component.tty as ingredient_component_tty\n\tfrom\n\t\tsagerx_lake.rxnorm_rxnrel rxnrel\n\tinner join sagerx_lake.rxnorm_rxnconso ingredient_component\n\t\ton rxnrel.rxcui1 = ingredient_component.rxcui\n\twhere rxnrel.rela = 'has_part'\n\t\tand ingredient_component.tty = 'IN'\n\t\tand ingredient_component.sab = 'RXNORM'\n)\n\nselect distinct\n\tingredient.rxcui as ingredient_rxcui\n\t, case when cte.ingredient_component_rxcui is null\n        then ingredient.rxcui\n        else cte.ingredient_component_rxcui\n        end as ingredient_component_rxcui\nfrom sagerx_lake.rxnorm_rxnconso ingredient\nleft join cte on ingredient.rxcui = cte.ingredient_rxcui\nwhere ingredient.tty in('IN', 'MIN')\n\tand ingredient.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_component_links\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.227606Z", "completed_at": "2025-05-29T02:24:58.229167Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.229445Z", "completed_at": "2025-05-29T02:24:58.229449Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002454042434692383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__ingredient_components", "compiled": true, "compiled_code": "-- stg_rxnorm__ingredient_components.sql\n\nwith cte as (\n\tselect\n\t\trxnrel.rxcui2 as ingredient_rxcui\n\t\t, ingredient_component.rxcui as rxcui\n\t\t, ingredient_component.str as name\n\t\t, ingredient_component.tty as tty\n\t\t, ingredient_component.suppress\n\t\t, ingredient_component.cvf\n\tfrom\n\t\tsagerx_lake.rxnorm_rxnrel rxnrel\n\tinner join sagerx_lake.rxnorm_rxnconso ingredient_component\n\t\ton rxnrel.rxcui1 = ingredient_component.rxcui\n\twhere rxnrel.rela = 'has_part'\n\t\tand ingredient_component.tty = 'IN'\n\t\tand ingredient_component.sab = 'RXNORM'\n)\n\nselect distinct\n\tcase when cte.rxcui is null then ingredient.rxcui else cte.rxcui end rxcui\n\t, case when cte.name is null then ingredient.str else cte.name end name\n\t, case when cte.tty is null then ingredient.tty else cte.tty end tty\n\t, case when \n\t\tcase when cte.rxcui is null then ingredient.suppress else cte.suppress end = 'N' then true else false end as active\n\t, case when \n\t\tcase when cte.rxcui is null then ingredient.cvf else cte.cvf end = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso ingredient\nleft join cte on ingredient.rxcui = cte.ingredient_rxcui\nwhere ingredient.tty in('IN', 'MIN')\n\tand ingredient.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_components\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.230764Z", "completed_at": "2025-05-29T02:24:58.232302Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.232577Z", "completed_at": "2025-05-29T02:24:58.232581Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0024526119232177734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__ingredient_strength_links", "compiled": true, "compiled_code": "-- stg_rxnorm__ingredient_strength_links.sql\n\nselect distinct\n\tproduct_component.rxcui as clinical_product_component_rxcui\n\t, ingredient.rxcui as ingredient_component_rxcui\n\t, ingredient_strength.rxcui as ingredient_strength_rxcui\nfrom sagerx_lake.rxnorm_rxnconso ingredient_strength\ninner join sagerx_lake.rxnorm_rxnrel has_ingredient\n    on has_ingredient.rxcui2 = ingredient_strength.rxcui\n    and has_ingredient.rela = 'has_ingredient'\ninner join sagerx_lake.rxnorm_rxnconso ingredient\n\ton ingredient.rxcui = has_ingredient.rxcui1\n\tand ingredient.tty = 'IN'\n\tand ingredient.sab = 'RXNORM'\ninner join sagerx_lake.rxnorm_rxnrel constitutes\n    on constitutes.rxcui2 = ingredient_strength.rxcui\n    and constitutes.rela = 'constitutes'\ninner join sagerx_lake.rxnorm_rxnconso product_component\n\ton product_component.rxcui = constitutes.rxcui1\n\tand product_component.tty = 'SCD'\n\tand product_component.sab = 'RXNORM'\nwhere ingredient_strength.tty = 'SCDC'\n\tand ingredient_strength.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strength_links\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.233851Z", "completed_at": "2025-05-29T02:24:58.235439Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.235714Z", "completed_at": "2025-05-29T02:24:58.235718Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002466440200805664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__ingredient_strengths", "compiled": true, "compiled_code": "-- stg_rxnorm__ingredient_strengths.sql\n\nselect\n\tingredient_strength.rxcui as rxcui\n\t, ingredient_strength.str as name\n\t, numerator_value.atv as numerator_value\n\t, numerator_unit.atv as numerator_unit\n\t, denominator_value.atv as denominator_value\n\t, denominator_unit.atv as denominator_unit\n\t, text.atv as text\n\t, case when ingredient_strength.suppress = 'N'\n        then true\n        else false\n        end as active\n\t, case when ingredient_strength.cvf = '4096'\n        then true\n        else false\n        end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso ingredient_strength\nleft join sagerx_lake.rxnorm_rxnsat numerator_value\n    on numerator_value.rxcui = ingredient_strength.rxcui\n    and numerator_value.atn = 'RXN_BOSS_STRENGTH_NUM_VALUE'\nleft join sagerx_lake.rxnorm_rxnsat numerator_unit\n    on numerator_unit.rxcui = ingredient_strength.rxcui\n    and numerator_unit.atn = 'RXN_BOSS_STRENGTH_NUM_UNIT'\nleft join sagerx_lake.rxnorm_rxnsat denominator_value\n    on denominator_value.rxcui = ingredient_strength.rxcui\n    and denominator_value.atn = 'RXN_BOSS_STRENGTH_DENOM_VALUE'\nleft join sagerx_lake.rxnorm_rxnsat denominator_unit\n    on denominator_unit.rxcui = ingredient_strength.rxcui\n    and denominator_unit.atn = 'RXN_BOSS_STRENGTH_DENOM_UNIT'\nleft join sagerx_lake.rxnorm_rxnsat text\n    on text.rxcui = ingredient_strength.rxcui\n    and text.atn = 'RXN_STRENGTH'\nwhere ingredient_strength.tty = 'SCDC'\n\tand ingredient_strength.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strengths\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.236990Z", "completed_at": "2025-05-29T02:24:58.238606Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.238887Z", "completed_at": "2025-05-29T02:24:58.238892Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002497434616088867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__ingredients", "compiled": true, "compiled_code": "-- stg_rxnorm__ingredients.sql\n\nselect\n\tingredient.rxcui rxcui\n\t, ingredient.str name\n\t, ingredient.tty tty\n\t, case when ingredient.suppress = 'N' then true else false end as active\n\t, case when ingredient.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso ingredient\nwhere ingredient.tty in('IN', 'MIN')\n\tand ingredient.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredients\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.240162Z", "completed_at": "2025-05-29T02:24:58.242473Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.242766Z", "completed_at": "2025-05-29T02:24:58.242771Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003215789794921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__mthspl_ndcs", "compiled": true, "compiled_code": "-- stg_rxnorm__mthspl_ndcs.sql\n\nselect\n    \n  \n  CASE WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN rxnsat.atv\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(rxnsat.atv,4) || REPLACE(RIGHT(rxnsat.atv,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(rxnsat.atv,5) || '0' || REPLACE(RIGHT(rxnsat.atv,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(rxnsat.atv,10),'-','') || '0' || RIGHT(rxnsat.atv, 1)\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(rxnsat.atv,'-','')\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN rxnsat.atv ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN rxnsat.atv ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN rxnsat.atv ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN rxnsat.atv ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11\n    , rxnsat.atv as ndc\n    , rxnsat.rxcui\n\t, case when rxnsat.suppress = 'N' then true else false end as active\n\t, case when rxnsat.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnsat rxnsat\n    where rxnsat.atn = 'NDC'\n        and rxnsat.sab = 'MTHSPL'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.244072Z", "completed_at": "2025-05-29T02:24:58.245844Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.246148Z", "completed_at": "2025-05-29T02:24:58.246153Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0027108192443847656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__mthspl_products", "compiled": true, "compiled_code": "-- stg_rxnorm__mthspl_products.sql\n\nselect\n\tproduct.rxcui as rxcui\n\t, product.str as name\n\t, product.tty as tty\n\t, product.rxaui as rxaui\n\t, product.code as ndc\n\t, case when product.suppress = 'N' then true else false end as active\n\t, case when product.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso product\nwhere product.tty = 'DP'\n\tand product.sab = 'MTHSPL'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_products\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.247669Z", "completed_at": "2025-05-29T02:24:58.249414Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.249704Z", "completed_at": "2025-05-29T02:24:58.249709Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0027031898498535156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__mthspl_substances", "compiled": true, "compiled_code": "-- stg_rxnorm__mthspl_substances.sql\n\nselect\n\tsubstance.rxcui rxcui\n\t, substance.str name\n\t, substance.tty tty\n\t, substance.rxaui rxaui\n\t, substance.code unii\n\t, case when substance.suppress = 'N' then true else false end as active\n\t, case when substance.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso substance\nwhere substance.tty = 'SU'\n\tand substance.sab = 'MTHSPL'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_substances\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.251030Z", "completed_at": "2025-05-29T02:24:58.253031Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.253351Z", "completed_at": "2025-05-29T02:24:58.253356Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0029621124267578125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__ndcs", "compiled": true, "compiled_code": "-- stg_rxnorm__ndcs.sql\n\nselect rxnsat.atv as ndc\n\t,case when product.tty in ('BPCK','SBD') then clinical_product.rxcui\n\t\telse rxnsat.rxcui end as clinical_product_rxcui\t\t\n\t,case when product.tty in ('BPCK','SBD') then rxnsat.rxcui\n\t\telse null end as brand_product_rxcui\n\t, case when rxnsat.suppress = 'N' then true else false end as active\n\t, case when rxnsat.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnsat rxnsat\n\tinner join sagerx_lake.rxnorm_rxnconso product on rxnsat.rxaui = product.rxaui\n\tleft join sagerx_lake.rxnorm_rxnrel rxnrel on rxnsat.rxcui = rxnrel.rxcui2 and rela = 'tradename_of' and product.tty in ('BPCK','SBD')\n\tleft join sagerx_lake.rxnorm_rxnconso clinical_product\n\t\ton rxnrel.rxcui1 = clinical_product.rxcui\n\t\tand clinical_product.tty in ('SCD','GPCK')\n\t\tand clinical_product.sab = 'RXNORM'\nwhere rxnsat.atn = 'NDC'\n\tand rxnsat.sab in ('ATC', 'CVX', 'DRUGBANK', 'MSH', 'MTHCMSFRF', 'MTHSPL', 'RXNORM', 'USP', 'VANDF')\n\tand product.tty in ('SCD','SBD','GPCK','BPCK')\n\tand product.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.254957Z", "completed_at": "2025-05-29T02:24:58.256706Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.256996Z", "completed_at": "2025-05-29T02:24:58.257001Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0027213096618652344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__precise_ingredient_links", "compiled": true, "compiled_code": "-- stg_rxnorm__precise_ingredient_links.sql\n\nselect distinct\n\tingredient_strength.rxcui as ingredient_strength_rxcui\n\t, precise_ingredient.rxcui as precise_ingredient_rxcui\nfrom sagerx_lake.rxnorm_rxnconso precise_ingredient\ninner join sagerx_lake.rxnorm_rxnrel precise_ingredient_of\n    on precise_ingredient_of.rxcui2 = precise_ingredient.rxcui\n    and precise_ingredient_of.rela = 'precise_ingredient_of'\ninner join sagerx_lake.rxnorm_rxnconso ingredient_strength\n\ton ingredient_strength.rxcui = precise_ingredient_of.rxcui1\n\tand ingredient_strength.tty = 'SCDC'\n\tand ingredient_strength.sab = 'RXNORM'\nwhere precise_ingredient.tty = 'PIN'\n\tand precise_ingredient.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__precise_ingredient_links\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.258418Z", "completed_at": "2025-05-29T02:24:58.260152Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.260442Z", "completed_at": "2025-05-29T02:24:58.260447Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0026853084564208984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__precise_ingredients", "compiled": true, "compiled_code": "-- stg_rxnorm__precise_ingredients.sql\n\nselect\n\tingredient.rxcui rxcui\n\t, ingredient.str name\n\t, ingredient.tty tty\n\t, case when ingredient.suppress = 'N' then true else false end as active\n\t, case when ingredient.cvf = '4096' then true else false end as prescribable\nfrom sagerx_lake.rxnorm_rxnconso ingredient\nwhere ingredient.tty = 'PIN'\n\tand ingredient.sab = 'RXNORM'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__precise_ingredients\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.261853Z", "completed_at": "2025-05-29T02:24:58.266352Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.266649Z", "completed_at": "2025-05-29T02:24:58.266654Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0054683685302734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__product_rxcuis", "compiled": true, "compiled_code": "-- stg_rxnorm__product_rxcuis\n\nselect * from \"sagerx\".\"sagerx_lake\".\"rxnorm_rxnconso\"\nwhere sab = 'RXNORM'\n    and tty in ('SCD', 'SBD', 'GPCK', 'BPCK')", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__product_rxcuis\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.268202Z", "completed_at": "2025-05-29T02:24:58.270542Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.270832Z", "completed_at": "2025-05-29T02:24:58.270837Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003301858901977539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm_historical__ndcs", "compiled": true, "compiled_code": "-- stg_rxnorm_historical__ndcs.sql\n\nselect\n    *\nfrom \"sagerx\".\"sagerx_lake\".\"rxnorm_historical\"", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm_historical__ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.272553Z", "completed_at": "2025-05-29T02:24:58.274993Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.275303Z", "completed_at": "2025-05-29T02:24:58.275308Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003752470016479492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxterms__names", "compiled": true, "compiled_code": "with\n\nrxterms as (\n\n    select * from \"sagerx\".\"sagerx_lake\".\"rxterms\"\n    \n)\n\nselect distinct\n    display_name as name\n    , display_name_synonym as synonyms\nfrom rxterms\nwhere suppress_for is null \n    and is_retired is null", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxterms__names\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.276968Z", "completed_at": "2025-05-29T02:24:58.280434Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.280778Z", "completed_at": "2025-05-29T02:24:58.280785Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004781484603881836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxterms__strengths", "compiled": true, "compiled_code": "with\n\nrxterms as (\n\n    select * from \"sagerx\".\"sagerx_lake\".\"rxterms\"\n    \n)\n\nselect distinct\n    rxcui\n    , display_name as name\n    , concat(strength, ' ', new_dose_form) as strength\nfrom rxterms\nwhere suppress_for is null \n    and is_retired is null", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxterms__strengths\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.282879Z", "completed_at": "2025-05-29T02:24:58.285810Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.286161Z", "completed_at": "2025-05-29T02:24:58.286167Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004321098327636719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_umls__crosswalk_codes", "compiled": true, "compiled_code": "-- stg_umls__crosswalk_codes.sql\n\nselect\n    -- TODO: make DAG store the source name (MSH)\n    -- so this is more general than just MeSH\n    'MSH' as from_source,\n    mesh_code as from_code,\n    root_source as to_source,\n    ui as to_code,\n    name as to_name\nfrom \"sagerx\".\"sagerx_lake\".\"umls_crosswalk\"\nwhere obsolete = false", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_umls__crosswalk_codes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.287855Z", "completed_at": "2025-05-29T02:24:58.289420Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.289861Z", "completed_at": "2025-05-29T02:24:58.289868Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002778768539428711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.sagerx.usp_preservatives", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.291575Z", "completed_at": "2025-05-29T02:24:58.300401Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.300772Z", "completed_at": "2025-05-29T02:24:58.300778Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009989023208618164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_ashp__current_drug_shortages_id.cb569e4e70", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect id\nfrom \"sagerx\".\"sagerx_dev\".\"stg_ashp__current_drug_shortages\"\nwhere id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.302381Z", "completed_at": "2025-05-29T02:24:58.308162Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.308484Z", "completed_at": "2025-05-29T02:24:58.308490Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006855010986328125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_ashp__current_drug_shortages_id.92d96b101c", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    id as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_ashp__current_drug_shortages\"\nwhere id is not null\ngroup by id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.309948Z", "completed_at": "2025-05-29T02:24:58.312797Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.313105Z", "completed_at": "2025-05-29T02:24:58.313110Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038313865661621094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_dailymed_organization_metrics", "compiled": true, "compiled_code": "/* intermediate.int_dailymed_organization_metrics */\n\nwith dailymed_main as (\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_dailymed__main\"\n),\n\ndailymed_organizations as (\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_dailymed__organizations\"\n),\n\ndailymed_organization_texts as (\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_dailymed__organization_texts\"\n)\n\nselect o.set_id\n\t, ma.market_status\n\t, sum(case when org_type = 'Functioner' then 1 else 0 end) as functioner_count\n\t, sum(case when org_type = 'Labeler' then 1 else 0 end) as labeler_count\n\t, sum(case when org_type = 'Repacker' then 1 else 0 end) as repacker_count\n\t, case when sum(case when ot.set_id is not null then 1 else 0 end) > 0 then 'Yes' else '' end as organization_text\n\t, case when sum(case when org_type = 'Labeler' then 1 else 0 end) = 1 \n\t\t\t\tand sum(case when org_type = 'Functioner' then 1 else 0 end) = 0\n\t\t\tthen 'yes' else '' end as labeler_only\n\t, count(*)\nfrom dailymed_main ma\n\tinner join dailymed_organizations o\n        on o.set_id = ma.set_id\n\tleft join dailymed_organization_texts ot\n        on o.set_id = ot.set_id\ngroup by o.set_id, ma.market_status", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_dailymed_organization_metrics\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.314523Z", "completed_at": "2025-05-29T02:24:58.316762Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.317051Z", "completed_at": "2025-05-29T02:24:58.317056Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0032279491424560547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__package_label_section_images", "compiled": true, "compiled_code": "/* stg_dailymed__package_label_section_images */\n\nwith\n\npackage_label_sections as\n(\n\tselect * from \"sagerx\".\"sagerx_dev\".\"stg_dailymed__package_label_sections\"\n),\n\nimages as (\n\n\tselect\n\t\tp.set_id,\n\t\tp.id as package_label_section_id,\n\t\ty.*\n\tfrom package_label_sections p,\n\t\txmltable(\n\t\t\t'//MediaList/Media' passing media_list\n\t\t\tcolumns \n\t\t\t\timage \t\ttext  path 'Image',\n\t\t\t\timage_id  \ttext  path 'ID'\n\t\t) y\n\n),\n\nid_images as (\n\n\tselect\n\t\trow_number() over() as id,\n\t\t*\n\tfrom images\n\n)\n\nselect * from id_images", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__package_label_section_images\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.318460Z", "completed_at": "2025-05-29T02:24:58.320627Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.321152Z", "completed_at": "2025-05-29T02:24:58.321158Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0036346912384033203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_dailymed__package_label_section_ndcs", "compiled": true, "compiled_code": "/* stg_dailymed__package_label_section_ndcs */\n\nwith\n\npackage_label_sections as\n(\n\tselect * from \"sagerx\".\"sagerx_dev\".\"stg_dailymed__package_label_sections\"\n),\n\nndcs as (\n\n\tselect\n\t\tp.set_id,\n\t\tp.id as package_label_section_id,\n\t\t-- TODO: account for NDCs with spaces instead of dashes\n\t\t-- example ndc 55292 140 01\n\t\t-- example set_id a0aad470-3f38-af97-e053-2995a90a383a\n\t\tregexp_replace(regexp_replace((regexp_matches(p.text, '(?:\\d{4}|\\d{5})\\s*(?:-|\u2013)\\s*\\d{3,6}\\s*(?:-|\u2013)\\s*\\d{1,2}|\\d{11}|\\d{10}', 'g'))[1], '\\s', '', 'g'), '\u2013', '-') as ndc\n\tfrom package_label_sections p\n\n),\n\nid_ndcs as (\n\n\tselect\n\t\trow_number() over() as id,\n\t\t*\n\tfrom ndcs\n\n)\n\nselect * from id_ndcs", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_dailymed__package_label_section_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.323651Z", "completed_at": "2025-05-29T02:24:58.326992Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.327278Z", "completed_at": "2025-05-29T02:24:58.327283Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00464177131652832, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_fda_excluded__ndcs_ndc11.f9b06099d2", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc11\nfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_excluded__ndcs\"\nwhere ndc11 is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.328666Z", "completed_at": "2025-05-29T02:24:58.332829Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.333117Z", "completed_at": "2025-05-29T02:24:58.333122Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005066633224487305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_fda_excluded__ndcs_ndc11.fcedc4532b", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    ndc11 as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_excluded__ndcs\"\nwhere ndc11 is not null\ngroup by ndc11\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.334445Z", "completed_at": "2025-05-29T02:24:58.336495Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.336769Z", "completed_at": "2025-05-29T02:24:58.336773Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.002978086471557617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.ndc_associations", "compiled": true, "compiled_code": "-- ndc_associations\n\nselect * from \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndc_associations\"", "relation_name": "\"sagerx\".\"sagerx_dev\".\"ndc_associations\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.338056Z", "completed_at": "2025-05-29T02:24:58.340213Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.340481Z", "completed_at": "2025-05-29T02:24:58.340485Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003026723861694336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.gtins", "compiled": true, "compiled_code": "-- gtins.sql\n\nwith\n\nndcs as (\n\n    select\n        ndc11,\n        replace(ndcpackagecode, '-', '') as ndc10,\n        ndcpackagecode as ndc,\n        concat(\n            '003',\n            replace(ndcpackagecode,'-', '')\n        ) as gtin13,\n        concat(\n            '3',\n            replace(ndcpackagecode,'-', '')\n        ) as gtin11,\n        concat(\n            '03',\n            split_part(ndcpackagecode, '-', 1)\n        ) as gs1_company_prefix\n\n    from \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"\n\n),\n\ndigits as (\n\n    -- split the 13-digit number into individual digits\n    select \n        ndc,\n        position,\n        substring(gtin13 from position for 1)::int as digit\n    from ndcs,\n        generate_series(1, 13) as position\n\n),\n\nproducts as (\n\n    -- apply the alternating multiplication rule\n    select \n        *,\n        case\n            when position % 2 = 1\n                then digit * 3\n            else digit * 1 \n        end as product\n    from digits\n\n),\n\nsums as (\n\n    -- sum of the products of each digit\n    select\n        ndc,\n        sum(product) as sum\n    from products\n    group by ndc\n\n),\n\ncheck_digits as (\n\n    -- round the sum to the nearest 10 and subtract the sum\n    select\n        ndc,\n        ceil(sum / 10.0) * 10 - sum as check_digit\n    from sums\n\n),\n\ngtin14s as (\n\n    -- concatenate the gtin13 and check_digit\n    select\n        ndc11,\n        ndc10,\n        ndcs.ndc,\n        concat(\n            gtin13,\n            check_digit\n        ) as gtin14,\n        concat(\n            gtin11,\n            check_digit\n        ) as gtin12,\n        gs1_company_prefix\n    from ndcs\n    left join check_digits\n        on check_digits.ndc = ndcs.ndc\n\n)\n\nselect * from gtin14s", "relation_name": "\"sagerx\".\"sagerx_dev\".\"gtins\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.341924Z", "completed_at": "2025-05-29T02:24:58.344380Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.344650Z", "completed_at": "2025-05-29T02:24:58.344654Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0034933090209960938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_fda_ndc_to_te", "compiled": true, "compiled_code": "-- DISCLAIMER: This model is under development and incomplete.\n\nwith cte as (\n    select\n        fda.ndc11\n        , obp.te_code\n        , count(fda.ndc11) over( partition by fda.ndc11 ) as num_te_codes\n    from \"sagerx\".\"sagerx_lake\".\"orange_book_products\" as obp\n    inner join \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\" as fda \n        on concat(case when obp.appl_type = 'A' then 'ANDA' else 'NDA' end, obp.appl_no) = fda.applicationnumber\n    group by fda.ndc11, obp.te_code\n)\nselect\n    fda.ndc11\n    , fda.applicationnumber as application_number\n    , cte.te_code\n    , left(cte.te_code, 2) as first_two_te_code\n    , left(cte.te_code, 1) as first_one_te_code\nfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\" as fda \ninner join cte \n    on fda.ndc11 = cte.ndc11 \n    and cte.num_te_codes = 1", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_fda_ndc_to_te\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.345941Z", "completed_at": "2025-05-29T02:24:58.349021Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.349309Z", "completed_at": "2025-05-29T02:24:58.349314Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003975391387939453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_fda_ndc__ndcs_ndc11.7680fa8975", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc11\nfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"\nwhere ndc11 is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.350609Z", "completed_at": "2025-05-29T02:24:58.353874Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.354346Z", "completed_at": "2025-05-29T02:24:58.354352Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004390716552734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_fda_ndc__ndcs_ndc11.8b4e77e239", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    ndc11 as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"\nwhere ndc11 is not null\ngroup by ndc11\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.356326Z", "completed_at": "2025-05-29T02:24:58.359486Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.359764Z", "completed_at": "2025-05-29T02:24:58.359769Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004231452941894531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_fda_packaging_components", "compiled": true, "compiled_code": "\n\nwith \n\nall_fda as (\n\tselect ndc11, packagedescription\n\tfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"\n\n\tunion all\n\n\tselect ndc11, packagedescription\n\tfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_excluded__ndcs\"\n\n\tunion all\n\n\tselect ndc11, packagedescription\n\tfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_unfinished__ndcs\"\n),\n\nsplit_components as (\n\tselect\n\t\tz.ndc11\n\t\t, z.packagedescription\n\t\t, z.ordinality as component_line\n\t\t, trim(z.token) as component_text\n\tfrom (\n\t\tselect distinct \n\t\t\tall_fda.ndc11\n\t\t\t, all_fda.packagedescription\n\t\t\t, s.token\n\t\t\t, s.ordinality\n\t\tfrom\n\t\t\tall_fda\n\t\t\t, unnest(\n\t\t\t\tstring_to_array(\n\t\t\t\t\tregexp_replace(\n\t\t\t\t\t\tall_fda.packagedescription\n\t\t\t\t\t\t, '(?<!\\*.*)\\/'\n\t\t\t\t\t\t, ' | '\n\t\t\t\t\t\t, 'g')\n\t\t\t\t\t, '|')\n\t\t\t\t) with ordinality as s(token, ordinality)\n\t) z\n\torder by ndc11, component_line\n),\n\ninner_outer_text as (\n\tselect\n\t\tc.*\n\t\t, trim(substring(component_text from '(.*) in ')) as inner_text\n\t\t, trim(substring(component_text from ' in (.*?)(?:\\(|$)')) as outer_text\n\t\t, trim(substring(component_text from '\\((.+)\\)')) as outer_ndc\n\tfrom split_components c\n),\n\ninner_outer_value_unit as (\n\n\tselect\n\t\t*\n\t\t, \n  \n  CASE WHEN \n  \n  \n    CASE WHEN outer_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN outer_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN outer_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN outer_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN outer_ndc\n     WHEN \n  \n  \n    CASE WHEN outer_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN outer_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(outer_ndc,4) || REPLACE(RIGHT(outer_ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN outer_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN outer_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(outer_ndc,5) || '0' || REPLACE(RIGHT(outer_ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN outer_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN outer_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(outer_ndc,10),'-','') || '0' || RIGHT(outer_ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN outer_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN outer_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(outer_ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN outer_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN outer_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN outer_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN outer_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN outer_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN outer_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as outer_ndc11\n\t\t, (regexp_match(inner_text, '^([^ ]+) (.+)'))[1]::numeric as inner_value\n\t\t, (regexp_match(inner_text, '^([^ ]+) (.+)'))[2] as inner_unit\n\t\t, (regexp_match(outer_text, '^([^ ]+) (.+)'))[1]::numeric as outer_value\n\t\t, (regexp_match(outer_text, '^([^ ]+) (.+)'))[2] as outer_unit\n\tfrom inner_outer_text\n\n),\n\ninner_outer_product as (\n\n\tselect\n\t\t*,\n\t\t(inner_value * outer_value)::numeric as product\n\tfrom inner_outer_value_unit\n\n),\n\ntotal_product as (\n\n\tselect\n\t\tndc11,\n\t\t-- NOTE: had to do this because was breaking build_marts - see #378\n\t\t--array_product(array_agg(product)) as total_product\n\t\tnull as total_product\n\tfrom inner_outer_product\n\twhere product > 0\n\tgroup by ndc11\n\n),\n\nfinal as (\n\n\tselect\n\t\ttotal_product,\n\t\tinner_outer_value_unit.*\n\tfrom inner_outer_value_unit\n\tleft join total_product\n\t\ton total_product.ndc11 = inner_outer_value_unit.ndc11\n\n)\n\nselect \n\t*\nfrom final", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_fda_packaging_components\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.361066Z", "completed_at": "2025-05-29T02:24:58.364091Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.364369Z", "completed_at": "2025-05-29T02:24:58.364374Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0039136409759521484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_fda_unfinished__ndcs_ndc11.0257f0c5fe", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc11\nfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_unfinished__ndcs\"\nwhere ndc11 is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.365686Z", "completed_at": "2025-05-29T02:24:58.368596Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.368876Z", "completed_at": "2025-05-29T02:24:58.368880Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003804922103881836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_fda_unfinished__ndcs_ndc11.dd8892c8c6", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    ndc11 as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_fda_unfinished__ndcs\"\nwhere ndc11 is not null\ngroup by ndc11\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.370184Z", "completed_at": "2025-05-29T02:24:58.373391Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.373672Z", "completed_at": "2025-05-29T02:24:58.373676Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004110574722290039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_nadac_historical_pricing", "compiled": true, "compiled_code": "-- int_nadac_all_pricing.sql\n\nwith\n\ncurrent_release as (\n/*\n    current release is where the as_of_date is the same\n    as the max(as_of_date)\n\n    we use this CTE as a flag later on in this data model\n    for people who want to only see the current release pricing\n*/\n\n    select distinct\n        ndc,\n        nadac_per_unit,\n        effective_date\n    from \"sagerx\".\"sagerx_dev\".\"stg_nadac__nadac\"\n    where as_of_date = (select max(as_of_date) from \"sagerx\".\"sagerx_dev\".\"stg_nadac__nadac\")\n\n),\n\nmost_recent_release as (\n/*\n    the most recent release may not be the current release\n    in cases where an NDC falls off of the list in the current\n    NADAC release (see current releases above)\n\n    in this case, the most recent release will be the\n    most recent as_of_date for a given NDC\n\n    we use this CTE to filter out prices where the as_of_date\n    increases, but the effective_date decreases\n\n    we also use it to de-duplicate variations in ndc_description\n*/\n\n    select\n        ndc,\n        ndc_description,\n        effective_date\n    from (\n        select\n            *,\n            row_number() over (\n                partition by ndc\n                order by as_of_date desc\n            ) as rn\n        from \"sagerx\".\"sagerx_dev\".\"stg_nadac__nadac\"\n    ) ranked\n    where rn = 1\n\n),\n\ndistinct_nadac_prices as (\n/*\n    mainly we want to filter out as_of_date which\n    is just an indicator of which release the data\n    came from\n\n    also - ndc_description can change over time so\n    we exclude it here and pull it instead from the\n    most_recent_release cte\n*/\n\n    select distinct\n\t\tnadac.ndc,\n        most_recent_release.ndc_description,\n\t\tnadac.nadac_per_unit,\n\t\tnadac.pricing_unit,\n\t\tnadac.effective_date,\n        max(as_of_date) over (\n            partition by\n                nadac.ndc,\n                nadac.nadac_per_unit,\n                nadac.effective_date\n        ) as max_as_of_for_price_and_effective_date\n    from \"sagerx\".\"sagerx_dev\".\"stg_nadac__nadac\" nadac\n    left join most_recent_release\n        on most_recent_release.ndc = nadac.ndc\n    -- this filters out prices where the as_of_date increases, but\n    -- the effective_date decreasees\n    where nadac.effective_date <= most_recent_release.effective_date\n\n),\n\nranked_price_start_dates as (\n\t\n\tselect \n\t\tndc,\n        ndc_description,\n\t\tnadac_per_unit,\n\t\tpricing_unit,\n\t\teffective_date as start_date,\n        -- the most recent effective_date will normally have null for an end_date\n        -- however - the end date is really the last time that price was in a NADAC release\n        -- this coalesce handles that and adds 6 days to the most recent as_of_date to\n        -- account for the price being valid during the week of the most recent release\n\t\tcoalesce(\n            lag(effective_date, 1) over (partition by ndc order by effective_date desc) - 1,\n            max_as_of_for_price_and_effective_date + 6\n        ) as end_date,\n        lag(nadac_per_unit, 1) over (partition by ndc order by effective_date asc) as previous_nadac_per_unit,\n        row_number() over (partition by ndc order by max_as_of_for_price_and_effective_date desc) as price_line,\n        count(*) over (partition by ndc) as max_price_line\n\tfrom distinct_nadac_prices\n\n),\n\nnadac_historical_pricing as (\n\n    select\n        ndc,\n        ndc_description,\n        nadac_per_unit,\n        pricing_unit,\n        start_date,\n        end_date,\n        case \n            when price_line = max_price_line\n                then true \n            else false\n            end as is_first_price,\n        case\n            when price_line = 1\n                then true\n            else false\n            end as is_last_price,\n        nadac_per_unit - previous_nadac_per_unit as dollar_change,\n        (nadac_per_unit - previous_nadac_per_unit) / previous_nadac_per_unit as percent_change,\n        case\n            when (nadac_per_unit - previous_nadac_per_unit) > 0\n                then 1\n            when (nadac_per_unit - previous_nadac_per_unit) = 0\n                then 0\n            when (nadac_per_unit - previous_nadac_per_unit) is null\n                then null\n            else -1\n            end as change_type\n    from ranked_price_start_dates\n    order by\n        ndc,\n        start_date\n\n),\n\nfinal as (\n\n    select\n        nadac_historical_pricing.*,\n        case when current_release.ndc is not null\n            then true\n            else false\n        end as is_from_current_release,\n        end_date >= current_date - interval '30 days' as is_within_30_days,\n        end_date >= current_date - interval '60 days' as is_within_60_days,\n        end_date >= current_date - interval '90 days' as is_within_90_days,\n        end_date >= current_date - interval '180 days' as is_within_180_days,\n        end_date >= current_date - interval '365 days' as is_within_365_days\n    from nadac_historical_pricing\n    left join current_release\n        on current_release.ndc = nadac_historical_pricing.ndc\n        and current_release.nadac_per_unit = nadac_historical_pricing.nadac_per_unit\n        and current_release.effective_date = nadac_historical_pricing.start_date\n    order by start_date desc\n\n)\n\nselect * from final", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_nadac_historical_pricing\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.374969Z", "completed_at": "2025-05-29T02:24:58.378098Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.378377Z", "completed_at": "2025-05-29T02:24:58.378381Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004019737243652344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_nadac__nadac_ndc.e0ba08012f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc\nfrom \"sagerx\".\"sagerx_dev\".\"stg_nadac__nadac\"\nwhere ndc is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.379699Z", "completed_at": "2025-05-29T02:24:58.382648Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.382924Z", "completed_at": "2025-05-29T02:24:58.382928Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038378238677978516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_nadac__nadac_ndc_description.373ce12b55", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc_description\nfrom \"sagerx\".\"sagerx_dev\".\"stg_nadac__nadac\"\nwhere ndc_description is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.384225Z", "completed_at": "2025-05-29T02:24:58.387683Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.387967Z", "completed_at": "2025-05-29T02:24:58.387971Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004366159439086914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxnorm_all_ndcs_to_product_rxcuis", "compiled": true, "compiled_code": "with all_ndcs as\n(\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__all_ndcs\"\n),\n\nproduct_rxcuis as\n(\n    select * from sagerx_lake.rxnorm_rxnconso\n    where sab = 'RXNORM'\n        and tty in ('SCD', 'SBD', 'GPCK', 'BPCK')\n)\n\nselect distinct\n    all_ndcs.ndc11\n    , product_rxcuis.rxcui\nfrom all_ndcs\ninner join product_rxcuis\n    on all_ndcs.rxcui = product_rxcuis.rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxnorm_all_ndcs_to_product_rxcuis\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.389291Z", "completed_at": "2025-05-29T02:24:58.392412Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.392697Z", "completed_at": "2025-05-29T02:24:58.392701Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004034757614135742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__brand_product_component_links_brand_product_component_rxcui.9f497ef16e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect brand_product_component_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_product_component_links\"\nwhere brand_product_component_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.394010Z", "completed_at": "2025-05-29T02:24:58.397162Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.397448Z", "completed_at": "2025-05-29T02:24:58.397452Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004061222076416016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__brand_product_component_links_brand_product_rxcui.6135a1fa50", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect brand_product_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_product_component_links\"\nwhere brand_product_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.398783Z", "completed_at": "2025-05-29T02:24:58.401949Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.402244Z", "completed_at": "2025-05-29T02:24:58.402249Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004086494445800781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__brand_product_components_clinical_product_component_rxcui.25fdaf356b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect clinical_product_component_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_product_components\"\nwhere clinical_product_component_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.403551Z", "completed_at": "2025-05-29T02:24:58.406481Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.406754Z", "completed_at": "2025-05-29T02:24:58.406758Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003829479217529297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__brand_product_components_rxcui.4917a3f0ca", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_product_components\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.408056Z", "completed_at": "2025-05-29T02:24:58.410963Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.411247Z", "completed_at": "2025-05-29T02:24:58.411251Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038089752197265625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__brand_product_components_rxcui.cd3b918573", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_product_components\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.412539Z", "completed_at": "2025-05-29T02:24:58.415462Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.415734Z", "completed_at": "2025-05-29T02:24:58.415738Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038166046142578125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__brand_products_rxcui.634ef0c2ff", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_products\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.417039Z", "completed_at": "2025-05-29T02:24:58.419917Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.420200Z", "completed_at": "2025-05-29T02:24:58.420204Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037758350372314453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__brand_products_rxcui.da77867bbd", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_products\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.421484Z", "completed_at": "2025-05-29T02:24:58.424400Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.424669Z", "completed_at": "2025-05-29T02:24:58.424674Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003803253173828125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__brands_rxcui.d067686860", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brands\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.426067Z", "completed_at": "2025-05-29T02:24:58.428975Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.429255Z", "completed_at": "2025-05-29T02:24:58.429260Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003911018371582031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__brands_rxcui.a2c8cd0cd0", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brands\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.430572Z", "completed_at": "2025-05-29T02:24:58.433722Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.434006Z", "completed_at": "2025-05-29T02:24:58.434011Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004076957702636719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__clinical_product_component_links_clinical_product_component_rxcui.869196279f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect clinical_product_component_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"\nwhere clinical_product_component_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.435377Z", "completed_at": "2025-05-29T02:24:58.439971Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.440269Z", "completed_at": "2025-05-29T02:24:58.440273Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0055615901947021484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__clinical_product_component_links_clinical_product_rxcui.94c75bf656", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect clinical_product_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"\nwhere clinical_product_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.441573Z", "completed_at": "2025-05-29T02:24:58.444502Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.444777Z", "completed_at": "2025-05-29T02:24:58.444782Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038340091705322266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__clinical_product_components_rxcui.0b9c81f7ae", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.446108Z", "completed_at": "2025-05-29T02:24:58.449684Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.450075Z", "completed_at": "2025-05-29T02:24:58.450094Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004663228988647461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__clinical_product_components_rxcui.2705e1f418", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.451858Z", "completed_at": "2025-05-29T02:24:58.454998Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.455294Z", "completed_at": "2025-05-29T02:24:58.455299Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00408172607421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm__products", "compiled": true, "compiled_code": "-- stg_rxnorm__products.sql\n\nselect\n\tproduct.rxcui as rxcui\n\t, product.str as name\n\t, product.tty as tty\n    , case\n        when brand_product.rxcui is not null then brand_product.clinical_product_rxcui\n        else product.rxcui\n        end as clinical_product_rxcui\n\t, case\n        when product.suppress = 'N' then true\n        else false\n        end as active\n\t, case \n        when product.cvf = '4096' then true \n        else false\n        end as prescribable\nfrom \"sagerx\".\"sagerx_lake\".\"rxnorm_rxnconso\" product\nleft join \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_products\" brand_product\n    on product.rxcui = brand_product.rxcui\nwhere product.tty in('SCD', 'GPCK', 'SBD', 'BPCK')\n\tand product.sab = 'RXNORM'\n\n/*\nwith\n\nrcp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\n\n),\n\nrbp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_products\"\n\n)\n\nselect distinct\n    coalesce(rbp.rxcui, rcp.rxcui, null) as product_rxcui\n    , coalesce(rbp.name, rcp.name, null) as product_name\n    , coalesce(rbp.tty, rcp.tty, null) as product_tty\n    , rcp.rxcui as clinical_product_rxcui\n    , rcp.name as clinical_product_name\n    , rcp.tty as clinical_product_tty\nfrom rcp\nleft join rbp\n    on rbp.clinical_product_rxcui = rcp.rxcui\n*/", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm__products\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.456643Z", "completed_at": "2025-05-29T02:24:58.460049Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.460356Z", "completed_at": "2025-05-29T02:24:58.460362Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0043718814849853516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__clinical_products_rxcui.5dd04a1235", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.462118Z", "completed_at": "2025-05-29T02:24:58.466930Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.467444Z", "completed_at": "2025-05-29T02:24:58.467451Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0062830448150634766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__clinical_products_rxcui.0bac3cbe9c", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.469095Z", "completed_at": "2025-05-29T02:24:58.472655Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.472965Z", "completed_at": "2025-05-29T02:24:58.472971Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004530191421508789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__dose_form_group_links_dose_form_group_rxcui.f4fde7102f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect dose_form_group_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_form_group_links\"\nwhere dose_form_group_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.474332Z", "completed_at": "2025-05-29T02:24:58.477628Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.477928Z", "completed_at": "2025-05-29T02:24:58.477933Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004247903823852539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__dose_form_group_links_dose_form_rxcui.3fdd0d4bb1", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect dose_form_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_form_group_links\"\nwhere dose_form_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.479271Z", "completed_at": "2025-05-29T02:24:58.482532Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.483047Z", "completed_at": "2025-05-29T02:24:58.483054Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004469871520996094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__dose_form_groups_rxcui.eca504df20", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_form_groups\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.485006Z", "completed_at": "2025-05-29T02:24:58.488378Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.488669Z", "completed_at": "2025-05-29T02:24:58.488674Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004341602325439453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__dose_form_groups_rxcui.b2e6200e1b", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_form_groups\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.490015Z", "completed_at": "2025-05-29T02:24:58.492925Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.493234Z", "completed_at": "2025-05-29T02:24:58.493238Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003846406936645508, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxnorm_clinical_products_to_dose_forms", "compiled": true, "compiled_code": "-- int_rxnorm_clinical_products_to_dose_forms.sql\n\nwith\n\nrcp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\n\n),\n\nrcpcl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"\n\n),\n\nrcpc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"\n\n),\n\nrdf as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_forms\"\n\n)\n\nselect\n    rcp.rxcui as clinical_product_rxcui\n    , rcp.name as clinical_product_name\n    , rcp.tty as clinical_product_tty\n    , rcpc.rxcui as clinical_product_component_rxcui\n    , rcpc.name as clinical_product_compnent_name\n    , rcpc.tty as clinical_product_component_tty\n    , rdf.rxcui as dose_form_rxcui\n    , rdf.name as dose_form_name\n    , rdf.tty as dose_form_tty\n    , rcp.active\n    , rcp.prescribable\nfrom rcp \nleft join rcpcl \n    on rcp.rxcui = rcpcl.clinical_product_rxcui \nleft join rcpc \n    on rcpcl.clinical_product_component_rxcui = rcpc.rxcui \nleft join rdf \n    on rcpc.dose_form_rxcui = rdf.rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_dose_forms\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.494536Z", "completed_at": "2025-05-29T02:24:58.497572Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.497848Z", "completed_at": "2025-05-29T02:24:58.497852Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0039370059967041016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__dose_forms_rxcui.a06bc0be08", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_forms\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.499161Z", "completed_at": "2025-05-29T02:24:58.503776Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.504072Z", "completed_at": "2025-05-29T02:24:58.504076Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005543708801269531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__dose_forms_rxcui.c7fb3a8da2", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_forms\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.505394Z", "completed_at": "2025-05-29T02:24:58.508522Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.508803Z", "completed_at": "2025-05-29T02:24:58.508807Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004044771194458008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ingredient_component_links_ingredient_component_rxcui.a6923961b3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ingredient_component_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_component_links\"\nwhere ingredient_component_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.510157Z", "completed_at": "2025-05-29T02:24:58.513214Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.513493Z", "completed_at": "2025-05-29T02:24:58.513497Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003999233245849609, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ingredient_component_links_ingredient_rxcui.303404889c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ingredient_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_component_links\"\nwhere ingredient_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.514787Z", "completed_at": "2025-05-29T02:24:58.517710Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.517991Z", "completed_at": "2025-05-29T02:24:58.517995Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038139820098876953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.accepted_values_stg_rxnorm__ingredient_components_tty__IN.5d941aec74", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        tty as value_field,\n        count(*) as n_records\n\n    from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_components\"\n    group by tty\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'IN'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.519299Z", "completed_at": "2025-05-29T02:24:58.522256Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.522538Z", "completed_at": "2025-05-29T02:24:58.522543Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003863811492919922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ingredient_components_rxcui.aed8b0d4c5", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_components\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.523848Z", "completed_at": "2025-05-29T02:24:58.526771Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.527060Z", "completed_at": "2025-05-29T02:24:58.527064Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038428306579589844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__ingredient_components_rxcui.75f7804348", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_components\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.528400Z", "completed_at": "2025-05-29T02:24:58.531917Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.532215Z", "completed_at": "2025-05-29T02:24:58.532220Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004467487335205078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ingredient_strength_links_clinical_product_component_rxcui.6be28272b5", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect clinical_product_component_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strength_links\"\nwhere clinical_product_component_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.533538Z", "completed_at": "2025-05-29T02:24:58.536711Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.536993Z", "completed_at": "2025-05-29T02:24:58.536998Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004097461700439453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ingredient_strength_links_ingredient_component_rxcui.fec66d7333", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ingredient_component_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strength_links\"\nwhere ingredient_component_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.538324Z", "completed_at": "2025-05-29T02:24:58.541422Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.541705Z", "completed_at": "2025-05-29T02:24:58.541709Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00401759147644043, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ingredient_strength_links_ingredient_strength_rxcui.3527b30bda", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ingredient_strength_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strength_links\"\nwhere ingredient_strength_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.543021Z", "completed_at": "2025-05-29T02:24:58.545926Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.546213Z", "completed_at": "2025-05-29T02:24:58.546218Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003816843032836914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ingredient_strengths_rxcui.d4a27e753c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strengths\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.547512Z", "completed_at": "2025-05-29T02:24:58.550400Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.550679Z", "completed_at": "2025-05-29T02:24:58.550683Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003793001174926758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__ingredient_strengths_rxcui.716f558a6b", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strengths\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.551996Z", "completed_at": "2025-05-29T02:24:58.556783Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.557072Z", "completed_at": "2025-05-29T02:24:58.557077Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005707740783691406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxnorm_clinical_products_to_ingredient_components", "compiled": true, "compiled_code": "-- int_rxnorm_clinical_products_to_ingredient_components.sql\n\nwith\n\nrcp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\n\n),\n\nrcpcl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"\n\n),\n\nrcpc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"\n\n),\n\nrdf as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_forms\"\n\n),\n\nri as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredients\"\n\n),\n\nricl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_component_links\"\n\n),\n\nric as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_components\"\n\n)\n\nselect\n    rcp.rxcui as clinical_product_rxcui\n    , rcp.name as clinical_product_name\n    , rcp.tty as clinical_product_tty\n    , rcpc.rxcui as clinical_product_component_rxcui\n    , rcpc.name as clinical_product_component_name\n    , rcpc.tty as clinical_product_component_tty\n    , rdf.rxcui as dose_form_rxcui\n    , rdf.name as dose_form_name\n    , rdf.tty as dose_form_tty\n    , ri.rxcui as ingredient_rxcui\n    , ri.name as ingredient_name\n    , ri.tty as ingredient_tty\n    , ric.rxcui as ingredient_component_rxcui\n    , ric.name as ingredient_component_name\n    , ric.tty as ingredient_component_tty\n    , rcp.active\n    , rcp.prescribable\nfrom rcp \nleft join rcpcl \n    on rcp.rxcui = rcpcl.clinical_product_rxcui \nleft join rcpc \n    on rcpcl.clinical_product_component_rxcui = rcpc.rxcui \nleft join rdf \n    on rcpc.dose_form_rxcui = rdf.rxcui \nleft join ri \n    on rcpc.ingredient_rxcui = ri.rxcui \nleft join ricl \n    on ri.rxcui = ricl.ingredient_rxcui \nleft join ric \n    on ricl.ingredient_component_rxcui = ric.rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ingredient_components\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.558389Z", "completed_at": "2025-05-29T02:24:58.561301Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.561582Z", "completed_at": "2025-05-29T02:24:58.561586Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038177967071533203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxnorm_clinical_products_to_ingredients", "compiled": true, "compiled_code": "-- int_rxnorm_clinical_products_to_ingredients.sql\n\nwith\n\nrcp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\n\n),\n\nrcpcl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"\n\n),\n\nrcpc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"\n\n),\n\nrdf as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_forms\"\n\n),\n\nri as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredients\"\n\n)\n\nselect\n    rcp.rxcui as clinical_product_rxcui\n    , rcp.name as clinical_product_name\n    , rcp.tty as clinical_product_tty\n    , string_agg(rcpc.rxcui, ' | ') as clinical_product_component_rxcui\n    , string_agg(rcpc.name, ' | ') as clinical_product_compnent_name\n    , string_agg(rcpc.tty, ' | ') as clinical_product_component_tty\n    , string_agg(rdf.rxcui, ' | ') as dose_form_rxcui\n    , string_agg(rdf.name, ' | ') as dose_form_name\n    , string_agg(rdf.tty, ' | ') as dose_form_tty\n    , string_agg(ri.rxcui, ' | ') as ingredient_rxcui\n    , string_agg(ri.name, ' | ') as ingredient_name\n    , string_agg(ri.tty, ' | ') as ingredient_tty\n    , rcp.active\n    , rcp.prescribable        \nfrom rcp \nleft join rcpcl \n    on rcp.rxcui = rcpcl.clinical_product_rxcui \nleft join rcpc \n    on rcpcl.clinical_product_component_rxcui = rcpc.rxcui \nleft join rdf \n    on rcpc.dose_form_rxcui = rdf.rxcui \nleft join ri \n    on rcpc.ingredient_rxcui = ri.rxcui \ngroup by\n    rcp.rxcui\n    , rcp.name\n    , rcp.tty\n    , rcp.active\n    , rcp.prescribable", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ingredients\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.562883Z", "completed_at": "2025-05-29T02:24:58.565878Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.566164Z", "completed_at": "2025-05-29T02:24:58.566169Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038950443267822266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ingredients_rxcui.24a1dca332", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredients\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.567470Z", "completed_at": "2025-05-29T02:24:58.570325Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.570602Z", "completed_at": "2025-05-29T02:24:58.570607Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037598609924316406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__ingredients_rxcui.c6b139419f", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredients\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.571894Z", "completed_at": "2025-05-29T02:24:58.574785Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.575063Z", "completed_at": "2025-05-29T02:24:58.575068Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003788471221923828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__mthspl_products_rxcui.21eb3d19b0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_products\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.576395Z", "completed_at": "2025-05-29T02:24:58.579233Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.579507Z", "completed_at": "2025-05-29T02:24:58.579511Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037658214569091797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__mthspl_products_rxaui.09d72011ed", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxaui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_products\"\nwhere rxaui is not null\ngroup by rxaui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.580804Z", "completed_at": "2025-05-29T02:24:58.583168Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.583455Z", "completed_at": "2025-05-29T02:24:58.583459Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003267526626586914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_mthspl_products_to_active_ingredients", "compiled": true, "compiled_code": "-- int_mthspl_products_to_active_ingredients.sql\n\nwith\n\nsubstance as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_substances\"\n\n),\n\nproduct as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_products\"\n\n)\n\nselect distinct\n    concat(lpad(split_part(product.ndc,'-', 1), 5, '0'), lpad(split_part(product.ndc,'-', 2), 4, '0')) as ndc9\n    , product.ndc as ndc\n    , product.rxcui as product_rxcui\n    , product.name as product_name\n    , product.tty as product_tty\n    , substance.unii as active_ingredient_unii\n    , substance.rxcui as active_ingredient_rxcui\n    , substance.name as active_ingredient_name\n    , substance.tty as active_ingredient_tty\t\n    , product.active as active\n    , product.prescribable as prescribable\nfrom sagerx_lake.rxnorm_rxnrel rxnrel\ninner join substance\n    on rxnrel.rxaui1 = substance.rxaui\ninner join product\n    on rxnrel.rxaui2 = product.rxaui\nwhere rela = 'has_active_ingredient'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_mthspl_products_to_active_ingredients\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.584759Z", "completed_at": "2025-05-29T02:24:58.587105Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.587392Z", "completed_at": "2025-05-29T02:24:58.587396Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0032486915588378906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_mthspl_products_to_active_moieties", "compiled": true, "compiled_code": "-- int_mthspl_products_to_active_moieties.sql\n\nwith\n\nsubstance as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_substances\"\n\n),\n\nproduct as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_products\"\n\n)\n\nselect distinct\n    concat(lpad(split_part(product.ndc,'-', 1), 5, '0'), lpad(split_part(product.ndc,'-', 2), 4, '0')) as ndc9\n    , product.ndc as ndc\n    , product.rxcui as product_rxcui\n    , product.name as product_name\n    , product.tty as product_tty\n    , substance.unii as active_moiety_unii\n    , substance.rxcui as active_moiety_rxcui\n    , substance.name as active_moiety_name\n    , substance.tty as active_moiety_tty\t\n    , product.active as active\n    , product.prescribable as prescribable\nfrom sagerx_lake.rxnorm_rxnrel rxnrel\ninner join substance\n    on rxnrel.rxaui1 = substance.rxaui\ninner join product\n    on rxnrel.rxaui2 = product.rxaui\nwhere rela = 'has_active_moiety'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_mthspl_products_to_active_moieties\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.588727Z", "completed_at": "2025-05-29T02:24:58.591042Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.591330Z", "completed_at": "2025-05-29T02:24:58.591334Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0032215118408203125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_mthspl_products_to_inactive_ingredients", "compiled": true, "compiled_code": "-- int_mthspl_products_to_inactive_ingredients.sql\n\nwith\n\nsubstance as (\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_substances\"\n)\n\n, product as (\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_products\"\n)\n\nselect distinct\n    concat(lpad(split_part(product.ndc,'-', 1), 5, '0'), lpad(split_part(product.ndc,'-', 2), 4, '0')) as ndc9\n    , product.ndc as ndc\n    , product.rxcui as product_rxcui\n    , product.name as product_name\n    , product.tty as product_tty\n    , substance.unii as inactive_ingredient_unii\n    , substance.rxcui as inactive_ingredient_rxcui\n    , substance.name as inactive_ingredient_name\n    , substance.tty as inactive_ingredient_tty\t\n    , product.active as active\n    , product.prescribable as prescribable\nfrom product\ninner join sagerx_lake.rxnorm_rxnrel rxnrel\n    on rxnrel.rxaui2 = product.rxaui\ninner join substance\n    on substance.rxaui = rxnrel.rxaui1\nwhere rela = 'has_inactive_ingredient'", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_mthspl_products_to_inactive_ingredients\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.592728Z", "completed_at": "2025-05-29T02:24:58.595663Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.595944Z", "completed_at": "2025-05-29T02:24:58.595949Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003837108612060547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__mthspl_substances_rxcui.1b38748ca6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__mthspl_substances\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.597368Z", "completed_at": "2025-05-29T02:24:58.600131Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.600450Z", "completed_at": "2025-05-29T02:24:58.600455Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003772735595703125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxnorm_clinical_products_to_clinical_product_components", "compiled": true, "compiled_code": "-- int_rxnorm_clinical_products_to_clinical_product_components.sql\n\nwith\n\nndc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ndcs\"\n\n),\n\nrcp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\n\n),\n\nrcpcl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"\n\n),\n\nrcpc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"\n\n)\n\nselect\n    rcp.rxcui as clinical_product_rxcui\n    , rcp.name as clinical_product_name\n    , rcp.tty as clinical_product_tty\n    , rcpc.rxcui as clinical_product_component_rxcui\n    , rcpc.name as clinical_product_compnent_name\n    , rcpc.tty as clinical_product_component_tty\n    , rcp.active\n    , rcp.prescribable\nfrom rcp \nleft join rcpcl \n    on rcp.rxcui = rcpcl.clinical_product_rxcui \nleft join rcpc \n    on rcpcl.clinical_product_component_rxcui = rcpc.rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_clinical_product_components\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.601768Z", "completed_at": "2025-05-29T02:24:58.604937Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.605229Z", "completed_at": "2025-05-29T02:24:58.605233Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004080533981323242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxnorm_clinical_products_to_ndcs", "compiled": true, "compiled_code": "-- int_rxnorm_clinical_products_to_ndcs.sql\n\nwith\n\nrcp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\n\n),\n\nrcpcl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"\n\n),\n\nrcpc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"\n\n),\n\nrdf as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_forms\"\n\n),\n\nri as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredients\"\n\n),\n\nrn as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ndcs\"\n\n)\n\nselect\n    rcp.rxcui as clinical_product_rxcui\n    , rcp.name as clinical_product_name\n    , rcp.tty as clinical_product_tty\n    , rcpc.rxcui as clinical_product_component_rxcui\n    , rcpc.name as clinical_product_compnent_name\n    , rcpc.tty as clinical_product_component_tty\n    , rdf.rxcui as dose_form_rxcui\n    , rdf.name as dose_form_name\n    , rdf.tty as dose_form_tty\n    , ri.rxcui as ingredient_rxcui\n    , ri.name as ingredient_name\n    , ri.tty as ingredient_tty\n    , rn.brand_product_rxcui\n    , rn.ndc\n    , rcp.active\n    , rcp.prescribable\nfrom rcp \nleft join rcpcl \n    on rcp.rxcui = rcpcl.clinical_product_rxcui \nleft join rcpc \n    on rcpcl.clinical_product_component_rxcui = rcpc.rxcui \nleft join rdf \n    on rcpc.dose_form_rxcui = rdf.rxcui \nleft join ri \n    on rcpc.ingredient_rxcui = ri.rxcui \nleft join rn\n    on rcp.rxcui = rn.clinical_product_rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.606532Z", "completed_at": "2025-05-29T02:24:58.610691Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.610973Z", "completed_at": "2025-05-29T02:24:58.610978Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005074977874755859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxnorm_ndcs_to_products", "compiled": true, "compiled_code": "-- int_rxnorm_ndcs_to_products.sql\n\nwith\n\nndc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ndcs\"\n\n),\n\nrcp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\n\n),\n\nrbp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_products\"\n\n)\n\nselect distinct\n    ndc\n    , coalesce(rbp.rxcui, rcp.rxcui, null) as product_rxcui\n    , coalesce(rbp.name, rcp.name, null) as product_name\n    , coalesce(rbp.tty, rcp.tty, null) as product_tty\n    , rcp.rxcui as clinical_product_rxcui\n    , rcp.name as clinical_product_name\n    , rcp.tty as clinical_product_tty\nfrom ndc\nleft join rcp \n    on ndc.clinical_product_rxcui = rcp.rxcui\nleft join rbp\n    on ndc.brand_product_rxcui = rbp.rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxnorm_ndcs_to_products\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.612287Z", "completed_at": "2025-05-29T02:24:58.615353Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.615632Z", "completed_at": "2025-05-29T02:24:58.615636Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003964424133300781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_stg_rxnorm__ndcs_ndc.4db0f5b5df", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ndcs\"\nwhere ndc is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.616921Z", "completed_at": "2025-05-29T02:24:58.619961Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.620248Z", "completed_at": "2025-05-29T02:24:58.620252Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003940105438232422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_stg_rxnorm__ndcs_ndc.9929df0b31", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    ndc as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ndcs\"\nwhere ndc is not null\ngroup by ndc\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.621557Z", "completed_at": "2025-05-29T02:24:58.625641Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.625930Z", "completed_at": "2025-05-29T02:24:58.625934Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00500798225402832, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_rxnorm_clinical_products_to_ingredient_strengths", "compiled": true, "compiled_code": "-- int_rxnorm_clinical_products_to_ingredient_strengths.sql\n\nwith\n\nrcp as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_products\"\n\n),\n\nrcpcl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_component_links\"\n\n),\n\nrcpc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__clinical_product_components\"\n\n),\n\nrdf as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__dose_forms\"\n\n),\n\nri as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredients\"\n\n),\n\nricl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_component_links\"\n\n),\n\nric as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_components\"\n\n),\n\nrisl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strength_links\"\n\n),\n\nris as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ingredient_strengths\"\n\n),\n\npinl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__precise_ingredient_links\"\n\n),\n\npin as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__precise_ingredients\"\n\n)\n\nselect\n    rcp.rxcui as clinical_product_rxcui\n    , rcp.name as clinical_product_name\n    , rcp.tty as clinical_product_tty\n    , rcpc.rxcui as clinical_product_component_rxcui\n    , rcpc.name as clinical_product_compnent_name\n    , rcpc.tty as clinical_product_component_tty\n    , rdf.rxcui as dose_form_rxcui\n    , rdf.name as dose_form_name\n    , rdf.tty as dose_form_tty\n    , ri.rxcui as ingredient_rxcui\n    , ri.name as ingredient_name\n    , ri.tty as ingredient_tty\n    , ric.rxcui as ingredient_component_rxcui\n    , ric.name as ingredient_component_name\n    , ric.tty as ingredient_component_tty\n    , ris.rxcui as ingredient_strength_rxcui\n    , ris.name as ingredient_strength_name\n    , ris.numerator_value as strength_numerator_value\n    , ris.numerator_unit as strength_numerator_unit\n    , ris.denominator_value as strength_denominator_value\n    , ris.denominator_unit as strength_denominator_unit\n    , ris.text as strength_text\n    , pin.rxcui as precise_ingredient_rxcui\n    , pin.name as precise_ingredient_name\n    , pin.tty as precise_ingredient_tty\n    , rcp.active\n    , rcp.prescribable\nfrom rcp \nleft join rcpcl \n    on rcp.rxcui = rcpcl.clinical_product_rxcui \nleft join rcpc \n    on rcpcl.clinical_product_component_rxcui = rcpc.rxcui \nleft join rdf \n    on rcpc.dose_form_rxcui = rdf.rxcui \nleft join ri \n    on rcpc.ingredient_rxcui = ri.rxcui \nleft join ricl \n    on ri.rxcui = ricl.ingredient_rxcui \nleft join ric \n    on ricl.ingredient_component_rxcui = ric.rxcui \nleft join risl \n    on rcpc.rxcui = risl.clinical_product_component_rxcui \n    and ric.rxcui = risl.ingredient_component_rxcui \nleft join ris \n    on risl.ingredient_strength_rxcui = ris.rxcui\nleft join pinl\n    on ris.rxcui = pinl.ingredient_strength_rxcui\nleft join pin\n    on pinl.precise_ingredient_rxcui = pin.rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ingredient_strengths\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.627249Z", "completed_at": "2025-05-29T02:24:58.629748Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.630021Z", "completed_at": "2025-05-29T02:24:58.630025Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003403186798095703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.atc_codes_to_rxnorm_products", "compiled": true, "compiled_code": "-- atc_codes_to_rxnorm_products\n\nwith rxclass_atcprod as (\n\n\tselect * from \"sagerx\".\"sagerx_dev\".\"stg_rxclass__rxclass\"\n    where rela_source = 'ATCPROD'\n\n)\n\n, atc_codes as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__atc_codes\"\n\n)\n\n, rxnorm_product_rxcuis as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__product_rxcuis\"\n\n)\n\nselect distinct\n\trxclass_atcprod.rxcui\n\t, rxnorm_product_rxcuis.str as rxnorm_description\n\t, atc_codes.atc_1_code\n\t, atc_codes.atc_2_code\n\t, atc_codes.atc_3_code\n\t, atc_codes.atc_4_code\n\t, atc_codes.atc_1_name\n\t, atc_codes.atc_2_name\n\t, atc_codes.atc_3_name\n\t, atc_codes.atc_4_name\nfrom rxclass_atcprod\nleft join atc_codes\n\ton atc_codes.atc_4_code = rxclass_atcprod.class_id\nleft join rxnorm_product_rxcuis\n\ton rxnorm_product_rxcuis.rxcui = rxclass_atcprod.rxcui\norder by rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"atc_codes_to_rxnorm_products\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.631328Z", "completed_at": "2025-05-29T02:24:58.633552Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.633841Z", "completed_at": "2025-05-29T02:24:58.633845Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0031363964080810547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.stg_rxnorm_historical__most_recent_ndcs", "compiled": true, "compiled_code": "-- stg_rxnorm_historical__most_recent_ndcs.sql\n\nwith \n\nrxnorm_historical_ndcs as\n(\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm_historical__ndcs\"\n)\n\n/*\nNOTE: we do this grouping and ranking to avoid NDCs that\nrelate to RXCUIs that have been remapped to multiple RXCUIs\n- see issue #265 for more details\n*/\n, grouped_and_ranked_rxnorm_historical_ndcs as\n(\n    \n    select\n        ndc\n        , end_date\n        , row_number() over (partition by ndc order by end_date desc) as end_date_line\n        , count(rxcui) as rxcui_count\n    from rxnorm_historical_ndcs\n    group by ndc, end_date\n    order by count(rxcui) desc\n\n)\n\nselect\n    rxnorm_historical_ndcs.*\nfrom grouped_and_ranked_rxnorm_historical_ndcs\ninner join rxnorm_historical_ndcs\n    on rxnorm_historical_ndcs.ndc = grouped_and_ranked_rxnorm_historical_ndcs.ndc\n    and rxnorm_historical_ndcs.end_date = grouped_and_ranked_rxnorm_historical_ndcs.end_date\nwhere rxcui_count = 1 -- only NDCs that are associated with one RXCUI per end_date\n\tand end_date_line = 1 -- only NDCs that are most recently associated with an RXCUI", "relation_name": "\"sagerx\".\"sagerx_dev\".\"stg_rxnorm_historical__most_recent_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.635166Z", "completed_at": "2025-05-29T02:24:58.637484Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.637812Z", "completed_at": "2025-05-29T02:24:58.637817Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003274202346801758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_umls_ingredient_components_to_crosswalk_codes", "compiled": true, "compiled_code": "-- int_umls_ingredient_components_to_crosswalk_codes.sql\n\nwith\n\ningredient_components as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"stg_rxclass__rxclass\"\n    where tty = 'IN'\n\n),\n\ncrosswalk_codes as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"stg_umls__crosswalk_codes\"\n)\n\nselect\n    ingredient_components.rxcui as ingredient_component_rxcui,\n    ingredient_components.name as ingredient_component_name,\n    ingredient_components.tty as ingredient_component_tty,\n    ingredient_components.rela,\n    ingredient_components.class_id,\n    ingredient_components.class_name,\n    ingredient_components.class_type,\n    ingredient_components.rela_source,\n    crosswalk_codes.*\nfrom ingredient_components\ninner join crosswalk_codes\n    on crosswalk_codes.from_code = ingredient_components.class_id", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_umls_ingredient_components_to_crosswalk_codes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.639135Z", "completed_at": "2025-05-29T02:24:58.641499Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.641780Z", "completed_at": "2025-05-29T02:24:58.641785Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003270387649536133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_umls_multiple_ingredients_to_crosswalk_codes", "compiled": true, "compiled_code": "-- int_umls_multiple_ingredients_to_crosswalk_codes.sql\n\nwith\n\nmultiple_ingredients as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"stg_rxclass__rxclass\"\n    where tty = 'MIN'\n\n),\n\ncrosswalk_codes as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"stg_umls__crosswalk_codes\"\n)\n\nselect\n    multiple_ingredients.rxcui as multiple_ingredient_rxcui,\n    multiple_ingredients.name as multiple_ingredient_name,\n    multiple_ingredients.tty as multiple_ingredient_tty,\n    multiple_ingredients.rela,\n    multiple_ingredients.class_id,\n    multiple_ingredients.class_name,\n    multiple_ingredients.class_type,\n    multiple_ingredients.rela_source,\n    crosswalk_codes.*\nfrom multiple_ingredients\ninner join crosswalk_codes\n    on crosswalk_codes.from_code = multiple_ingredients.class_id", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_umls_multiple_ingredients_to_crosswalk_codes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.643179Z", "completed_at": "2025-05-29T02:24:58.645437Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.645716Z", "completed_at": "2025-05-29T02:24:58.645720Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0032417774200439453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_umls_precise_ingredients_to_crosswalk_codes", "compiled": true, "compiled_code": "-- int_umls_precise_ingredients_to_crosswalk_codes.sql\n\nwith\n\nprecise_ingredients as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"stg_rxclass__rxclass\"\n    where tty = 'PIN'\n\n),\n\ncrosswalk_codes as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"stg_umls__crosswalk_codes\"\n)\n\nselect\n    precise_ingredients.rxcui as precise_ingredient_rxcui,\n    precise_ingredients.name as precise_ingredient_name,\n    precise_ingredients.tty as precise_ingredient_tty,\n    precise_ingredients.rela,\n    precise_ingredients.class_id,\n    precise_ingredients.class_name,\n    precise_ingredients.class_type,\n    precise_ingredients.rela_source,\n    crosswalk_codes.*\nfrom precise_ingredients\ninner join crosswalk_codes\n    on crosswalk_codes.from_code = precise_ingredients.class_id", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_umls_precise_ingredients_to_crosswalk_codes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.647006Z", "completed_at": "2025-05-29T02:24:58.649911Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.650291Z", "completed_at": "2025-05-29T02:24:58.650295Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038950443267822266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_dailymed_image_name_ndcs", "compiled": true, "compiled_code": "-- int_dailymed_image_name_ndcs\n\nwith\n\npackage_label_section_images as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_dailymed__package_label_section_images\"\n\n),\n\nregex_ndcs as (\n\n    select\n        *,\n        (regexp_matches(image, '(?:\\d{4}|\\d{5})-\\d{3,6}(?:-\\d{1,2})?|\\d{11}|\\d{10}', 'g'))[1] as regex_ndc\n    from package_label_section_images\n\n    /*\n        \\d{11}              | # 11 digit\n        \\d{10}              | # 10 digit\n        \\d{5}-\\d{5}         | # 5-5\n        \\d{5}-\\d{4}-\\d{2}   | # 5-4-2\n        \\d{5}-\\d{4}-\\d{1}   | # 5-4-1\n        \\d{5}-\\d{3}-\\d{2}   | # 5-3-2\n        \\d{4}-\\d{6}         | # 4-6\n        \\d{4}-\\d{4}-\\d{2}     # 4-4-2\n    */\n\n),\n\nvalid_spl_ndcs as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_dailymed__ndcs\"\n\n),\n\nvalidated_ndcs as (\n\n    select\n        regex_ndcs.*,\n        spl_ndc.ndc,\n        spl_ndc.ndc11\n    from regex_ndcs\n    inner join valid_spl_ndcs spl_ndc\n        on spl_ndc.set_id = regex_ndcs.set_id\n        and \n  \n  CASE WHEN \n  \n  \n    CASE WHEN spl_ndc.ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN spl_ndc.ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN spl_ndc.ndc\n     WHEN \n  \n  \n    CASE WHEN spl_ndc.ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(spl_ndc.ndc,4) || REPLACE(RIGHT(spl_ndc.ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN spl_ndc.ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(spl_ndc.ndc,5) || '0' || REPLACE(RIGHT(spl_ndc.ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN spl_ndc.ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(spl_ndc.ndc,10),'-','') || '0' || RIGHT(spl_ndc.ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN spl_ndc.ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(spl_ndc.ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN spl_ndc.ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN spl_ndc.ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN spl_ndc.ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN spl_ndc.ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n = \n  \n  CASE WHEN \n  \n  \n    CASE WHEN regex_ndcs.regex_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN regex_ndcs.regex_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN regex_ndcs.regex_ndc\n     WHEN \n  \n  \n    CASE WHEN regex_ndcs.regex_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(regex_ndcs.regex_ndc,4) || REPLACE(RIGHT(regex_ndcs.regex_ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN regex_ndcs.regex_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(regex_ndcs.regex_ndc,5) || '0' || REPLACE(RIGHT(regex_ndcs.regex_ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN regex_ndcs.regex_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(regex_ndcs.regex_ndc,10),'-','') || '0' || RIGHT(regex_ndcs.regex_ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN regex_ndcs.regex_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(regex_ndcs.regex_ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN regex_ndcs.regex_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN regex_ndcs.regex_ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN regex_ndcs.regex_ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n\n\n)\n\nselect * from validated_ndcs", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_dailymed_image_name_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.651587Z", "completed_at": "2025-05-29T02:24:58.653652Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.653931Z", "completed_at": "2025-05-29T02:24:58.653935Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0029649734497070312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_dailymed_ranked_package_label_images", "compiled": true, "compiled_code": "with\n\npackage_label_images as (\n\n    select * from\"sagerx\".\"sagerx_dev\".\"stg_dailymed__package_label_section_images\"\n\n),\n\nranked_package_images as (\n\n    select \n        *,\n        row_number() over (\n            partition by package_label_section_id\n            order by id\n        ) as rn\n    from package_label_images\n\n)\n\nselect * from ranked_package_images", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_dailymed_ranked_package_label_images\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.655281Z", "completed_at": "2025-05-29T02:24:58.657763Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.658050Z", "completed_at": "2025-05-29T02:24:58.658056Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003418445587158203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_dailymed_validated_package_label_ndcs", "compiled": true, "compiled_code": "--int_dailymed_validated_package_label_ndcs\n\nwith\n\nvalid_spl_ndcs as (\n\n    select * from\"sagerx\".\"sagerx_dev\".\"stg_dailymed__ndcs\"\n\n),\n\npackage_label_ndc_matches as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_dailymed__package_label_section_ndcs\"\n\n),\n\nvalidated_package_ndcs as (\n\n    select\n        *\n    from package_label_ndc_matches pkg_ndc\n    where exists (\n\n        select\n            ndc\n        from valid_spl_ndcs\n        where ndc = pkg_ndc.ndc\n        \n    )\n\n)\n\nselect * from validated_package_ndcs", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_dailymed_validated_package_label_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.659523Z", "completed_at": "2025-05-29T02:24:58.664058Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.664379Z", "completed_at": "2025-05-29T02:24:58.664385Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00565028190612793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_fda_packaging_parts", "compiled": true, "compiled_code": "\n\nwith \n\npackaging_components as (\n\tselect * from \"sagerx\".\"sagerx_dev\".\"int_fda_packaging_components\"\n\twhere component_text like ('%*%')\n)\n\nselect\n\tz.ndc11\n    , z.packagedescription\n\t, z.component_line\n\t, z.component_text\n   \t, z.ordinality as part_line\n\t, trim(z.token) as part_text\nfrom (\n    select distinct \n        components.*\n\t    , s.token\n        , s.ordinality\n\tfrom\n\t\tpackaging_components components\n\t\t, unnest(\n\t\t\tstring_to_array(\n\t\t\t\tcomponent_text\n\t\t\t\t, '*')\n\t\t\t) with ordinality as s(token, ordinality)\n) z\norder by ndc11, component_line, part_line", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_fda_packaging_parts\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.665764Z", "completed_at": "2025-05-29T02:24:58.668334Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.668801Z", "completed_at": "2025-05-29T02:24:58.668810Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037276744842529297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.pack_size", "compiled": true, "compiled_code": "with\n\npackaging_components as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_fda_packaging_components\"\n\n),\n\ninnermost_unit as (\n\n    select ndc11, inner_unit\n    from (\n        select ndc11, inner_unit, \n            row_number() over (partition by ndc11 order by component_line desc) as row_num\n        from packaging_components\n    ) as ranked\n    where row_num = 1\n\n),\n\noutermost_unit as (\n\n    select ndc11, outer_unit\n    from packaging_components\n    where component_line = 1\n\n)\n\nselect distinct\n    packaging_components.ndc11,\n    outermost_unit.outer_unit as outermost_unit,\n    total_product,\n    case\n        when innermost_unit.inner_unit like('%KIT %')\n            then 'KIT' \n        else innermost_unit.inner_unit \n    end as innermost_unit,\n    packagedescription\nfrom packaging_components\nleft join innermost_unit\n    on innermost_unit.ndc11 = packaging_components.ndc11\nleft join outermost_unit\n    on outermost_unit.ndc11 = packaging_components.ndc11", "relation_name": "\"sagerx\".\"sagerx_dev\".\"pack_size\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.671096Z", "completed_at": "2025-05-29T02:24:58.674603Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.675086Z", "completed_at": "2025-05-29T02:24:58.675094Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005000591278076172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_nadac_pricing", "compiled": true, "compiled_code": "-- int_nadac_pricing.sql\n\nwith\n\npricing as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_nadac_historical_pricing\"\n    where is_last_price\n    order by ndc_description\n\n)\n\nselect * from pricing", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_nadac_pricing\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.677194Z", "completed_at": "2025-05-29T02:24:58.681342Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.681659Z", "completed_at": "2025-05-29T02:24:58.681664Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005507230758666992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.pricing_historical", "compiled": true, "compiled_code": "-- pricing_historical.sql\n\nwith\n\nnadac_historical as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_nadac_historical_pricing\"\n\n),\n\nmccpd as (\n\n    select\n        *\n    -- TODO: make a stanging table and int table instead of hitting source in a mart\n    from \"sagerx\".\"sagerx_lake\".\"mccpd\"\n),\n\nall_ndcs as (\n\n    select ndc from nadac_historical\n\n    union\n\n    select ndc from mccpd\n\n),\n\npricing as (\n\n    select\n        all_ndcs.*,\n        nadac_historical.ndc_description as nadac_description,\n        nadac_historical.nadac_per_unit,\n        mccpd.medication_name as mccpd_description,\n        mccpd.unit_billing_price,\n        mccpd.unit_price\n    from all_ndcs\n    left join nadac_historical\n        on nadac_historical.ndc = all_ndcs.ndc\n    left join mccpd\n        on mccpd.ndc = all_ndcs.ndc\n\n)\n\nselect * from pricing", "relation_name": "\"sagerx\".\"sagerx_dev\".\"pricing_historical\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.683620Z", "completed_at": "2025-05-29T02:24:58.687933Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.688337Z", "completed_at": "2025-05-29T02:24:58.688343Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005739688873291016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_int_nadac_historical_pricing_nadac_per_unit.b59e04bbe2", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect nadac_per_unit\nfrom \"sagerx\".\"sagerx_dev\".\"int_nadac_historical_pricing\"\nwhere nadac_per_unit is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.690535Z", "completed_at": "2025-05-29T02:24:58.695754Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.696209Z", "completed_at": "2025-05-29T02:24:58.696215Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006827116012573242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_int_nadac_historical_pricing_ndc.016eae71ab", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc\nfrom \"sagerx\".\"sagerx_dev\".\"int_nadac_historical_pricing\"\nwhere ndc is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.698532Z", "completed_at": "2025-05-29T02:24:58.702978Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.703336Z", "completed_at": "2025-05-29T02:24:58.703342Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005942583084106445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_int_nadac_historical_pricing_pricing_unit.17c0de2826", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect pricing_unit\nfrom \"sagerx\".\"sagerx_dev\".\"int_nadac_historical_pricing\"\nwhere pricing_unit is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.704721Z", "completed_at": "2025-05-29T02:24:58.707661Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.707944Z", "completed_at": "2025-05-29T02:24:58.707948Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038640499114990234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.products", "compiled": true, "compiled_code": "with\n\nrxnorm_products as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__products\"\n\n),\n\nrxnorm_psn as (\n\n    select\n        rxcui,\n        str        \n    from \"sagerx\".\"sagerx_lake\".\"rxnorm_rxnconso\"\n    where sab = 'RXNORM'\n        and tty = 'PSN'\n\n),\n\nrxnorm_clinical_products_to_ingredients as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ingredients\"\n\n)\n\nselect\n    prod.rxcui as product_rxcui\n    , prod.name as product_name\n    , prod.tty as product_tty\n    , psn.str as prescribable_name\n    , case\n        when prod.tty in ('SBD', 'BPCK') then 'brand'\n        when prod.tty in ('SCD', 'GPCK') then 'generic'\n        end as brand_vs_generic\n    , substring(prod.name from '\\[(.*)\\]') as brand_name\n    , cping.clinical_product_rxcui\n    , cping.clinical_product_name\n    , cping.clinical_product_tty\n    , cping.ingredient_name\n    -- strength - couldn't easily get strength at this grain - can if needed\n    , cping.dose_form_name\n    , prod.active\n    , prod.prescribable\nfrom rxnorm_products prod\nleft join rxnorm_clinical_products_to_ingredients cping\n    on cping.clinical_product_rxcui = prod.clinical_product_rxcui\nleft join rxnorm_psn psn\n    on psn.rxcui = prod.rxcui", "relation_name": "\"sagerx\".\"sagerx_dev\".\"products\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.709340Z", "completed_at": "2025-05-29T02:24:58.712309Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.712616Z", "completed_at": "2025-05-29T02:24:58.712621Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003916025161743164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.products_to_inactive_ingredients", "compiled": true, "compiled_code": "-- products_to_inactive_ingredients.sql\n\nwith products_to_inactive_ingredients as (\n    select * from \"sagerx\".\"sagerx_dev\".\"int_mthspl_products_to_inactive_ingredients\"\n)\n\n, unii_codes as (\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_fda_unii__unii_codes\"\n)\n\n, usp_preservatives as (\n    select * from \"sagerx\".\"sagerx_dev\".\"usp_preservatives\"\n)\n\nselect\n    ndc9\n    , ndc\n    , unii_codes.unii as fda_unii_code\n    , unii_codes.display_name as fda_unii_display_name\n    , unii_codes.pubchem as pubchem_id\n    , max(case\n        when preservative.cas_rn is not null\n            then 1\n        end) as preservative\n    , product_rxcui\n    , string_agg(product_name, ' | ') as product_name\n    , product_tty\n    , inactive_ingredient_unii\n    , inactive_ingredient_rxcui\n    , string_agg(inactive_ingredient_name, ' | ') as inactive_ingredient_name\n    , inactive_ingredient_tty\n    , active\n    , prescribable\nfrom products_to_inactive_ingredients\n/*\nneed to join unii_codes twice - once\nto pull in the actual UNII -> displa\ny name\nmapping, and another initial one to try\nto map substance RXCUIs to FDA UNII RXCUIs.\n*/\nleft join unii_codes rxcui_to_unii\n    on rxcui_to_unii.rxcui = inactive_ingredient_rxcui\n/*\nif MTHSPL (DailyMed) has a substance UNII,\nuse that. if it does not, try to map the\nsubstance RXCUI to the FDA UNII RXCUI and\nthen use the resulting matched UNII to pull\nin the UNII display name.\n*/\nleft join unii_codes\n    on unii_codes.unii = case\n        when (\n            inactive_ingredient_unii is not null \n            and\n            inactive_ingredient_unii != 'NOCODE'\n        ) then inactive_ingredient_unii\n        else rxcui_to_unii.unii\n        end\nleft join usp_preservatives preservative\n    on preservative.cas_rn = unii_codes.rn\ngroup by\n    ndc9\n    , ndc\n    , unii_codes.unii\n    , unii_codes.display_name\n    , unii_codes.pubchem\n    , product_rxcui\n    , product_tty\n    , inactive_ingredient_unii\n    , inactive_ingredient_rxcui\n    , inactive_ingredient_tty\n    , active\n    , prescribable", "relation_name": "\"sagerx\".\"sagerx_dev\".\"products_to_inactive_ingredients\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.713913Z", "completed_at": "2025-05-29T02:24:58.716490Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.716768Z", "completed_at": "2025-05-29T02:24:58.716772Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0034677982330322266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.brand_products_with_related_ndcs", "compiled": true, "compiled_code": "with brand_products as (\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__brand_products\"\n)\n\n, fda_ndcs as (\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"\n)\n\n, rxnorm_ndcs_to_products as (\n    select * from \"sagerx\".\"sagerx_dev\".\"int_rxnorm_ndcs_to_products\"\n)\n\n, map as (\n    select\n        prod.tty as product_tty\n        , prod.rxcui as product_rxcui\n        , prod.name as product_name\n        , ndc.product_tty as ndc_product_tty\n        , ndc.product_rxcui as ndc_product_rxcui\n        , ndc.product_name as ndc_product_name\n        , ndc.ndc\n        , fda.product_startmarketingdate\n        , fda.package_startmarketingdate\n    from brand_products prod\n    left join rxnorm_ndcs_to_products ndc\n        on ndc.clinical_product_rxcui = prod.clinical_product_rxcui\n    left join fda_ndcs fda\n        on fda.ndc11 = ndc.ndc\n    order by prod.rxcui\n)\n\nselect\n    *\nfrom map", "relation_name": "\"sagerx\".\"sagerx_dev\".\"brand_products_with_related_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.718122Z", "completed_at": "2025-05-29T02:24:58.721369Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.721653Z", "completed_at": "2025-05-29T02:24:58.721657Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0042002201080322266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_inactive_ingredients_to_fda_enforcement_reports", "compiled": true, "compiled_code": "with\n\nregex_ndcs as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_fda_enforcement__regex_ndcs\"\n\n),\n\njson_ndcs as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_fda_enforcement__json_ndcs\"\n\n),\n\nenf as (\n    -- UNION RegEx NDCs from description and JSON NDCs from OpenFDA column\n    -- NOTE: UNION removes duplicates by default, which is what we want here\n    select * from (\n        -- first get only the NDCs from combined RegEx and JSON enforcement report data\n        select \n            recall_number\n            , ndc11\n            , ndc9\n        from regex_ndcs\n        \n        union\n        \n        select\n            recall_number\n            , ndc11\n            , ndc9\n        from json_ndcs\n    ) enf_ndcs\n    -- then, join NDCs with application numbers, where they exist from JSON data\n    left join (\n        -- get distinct NDC11 -> application numbers so as to not blow up granularity\n        select\n            ndc11\n            , app_num\n        from json_ndcs\n        group by\n            ndc11\n            , app_num\n    ) json_app_num\n        on enf_ndcs.ndc11 = json_app_num.ndc11\n),\n\nndc as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"int_rxnorm_ndcs_to_products\"\n\n),\n\ning as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ingredients\"\n\n),\n\nspl as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"int_mthspl_products_to_inactive_ingredients\"\n\n),\n\nfda as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"\n\n)\n\nselect distinct\n    ndc.ndc as ndc11\n    , left(ndc.ndc, 9) as ndc9\n    , ndc.product_rxcui\n    , ndc.product_name\n    , ndc.product_tty\n    , ndc.clinical_product_rxcui\n    , ndc.clinical_product_name\n    , ndc.clinical_product_tty\n    , ing.ingredient_rxcui as active_ingredient_rxcui\n    , ing.ingredient_name as active_ingredient_name\n    , ing.ingredient_tty as active_ingredient_tty\n    -- if FDA NDC Directory has an application number, use that...\n    -- otherwise, use the application number from the enforcement report JSON\n    , coalesce(fda.applicationnumber, enf.app_num) as application_number\n    , fda.labelername as labeler\n    , enf.recall_number\n    , spl.inactive_ingredient_unii\n    , spl.inactive_ingredient_rxcui\n    , spl.inactive_ingredient_name\n    , spl.inactive_ingredient_tty\n-- RxNorm NDCs that have one of the ingredients in the WHERE clause\nfrom ndc\n-- clinical product and related active ingredients for each NDC\nleft join ing\n    on ing.clinical_product_rxcui = ndc.clinical_product_rxcui\n-- FDA enforcement reports (UNION of RegEx and JSON) joined on NDC9\nleft join enf\n    on enf.ndc9 = left(ndc.ndc, 9)\n-- DailyMed SPL inactive ingredients joined on NDC9\nleft join spl\n    on spl.ndc9 = left(ndc.ndc, 9)\n-- FDA NDC Directory joined on NDC11 to pull in application number\nleft join fda\n    on fda.ndc11 = ndc.ndc", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_inactive_ingredients_to_fda_enforcement_reports\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.723148Z", "completed_at": "2025-05-29T02:24:58.727720Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.728010Z", "completed_at": "2025-05-29T02:24:58.728015Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005502223968505859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.product_synonyms", "compiled": true, "compiled_code": "with\n\nrxnorm_synonyms as (\n\n    select\n        str as synonym,\n        rxcui as product_rxcui,\n        'RXNORM' as source\n    from \"sagerx\".\"sagerx_lake\".\"rxnorm_rxnconso\"\n    where sab = 'RXNORM'\n    and tty in('PSN', 'SY', 'TMSY', 'ET')\n\n),\n\nnadac_synonyms as (\n\n    select distinct\n        ndc_description as synonym,\n        product_rxcui,\n        'NADAC' as source\n    from \"sagerx\".\"sagerx_lake\".\"nadac\" n\n    left join \"sagerx\".\"sagerx_dev\".\"int_rxnorm_ndcs_to_products\" r\n        on r.ndc = n.ndc\n    where r.product_rxcui is not null\n\n),\n\nfda_synonyms as (\n\n    select distinct\n        trim(concat(\n            nonproprietaryname\n            , ' '\n            , active_numerator_strength\n            , ' '\n            , active_ingred_unit\n            , ' '\n            , lower(dosageformname)\n            , case when proprietaryname is not null then concat(\n                ' ['\n                , proprietaryname\n                , case when proprietarynamesuffix is not null then concat(\n                    ' '\n                    , proprietarynamesuffix\n                    ) else '' end\n                , ']'\n                ) else '' end\n            )) as synonym,\n            product_rxcui,\n            'FDA' as source\n    from sagerx_dev.stg_fda_ndc__ndcs f\n    left join sagerx_dev.int_rxnorm_ndcs_to_products r\n        on r.ndc = f.ndc11\n    where r.product_rxcui is not null\n\n),\n\nall_synonyms as (\n    \n    select * from rxnorm_synonyms\n\n    union\n\n    select * from nadac_synonyms\n\n    union\n\n    select * from fda_synonyms\n\n),\n\nrxnorm_products as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__products\"\n\n),\n\nprescribable_product_synonyms as (\n\n    select\n        all_synonyms.*\n    from all_synonyms\n    inner join rxnorm_products\n        on rxnorm_products.rxcui = all_synonyms.product_rxcui\n    where rxnorm_products.prescribable = true\n\n)\n\nselect * from prescribable_product_synonyms", "relation_name": "\"sagerx\".\"sagerx_dev\".\"product_synonyms\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.729342Z", "completed_at": "2025-05-29T02:24:58.734110Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.734401Z", "completed_at": "2025-05-29T02:24:58.734406Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005690574645996094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_atc_codes_to_rxnorm_products_rxcui.f1ef3093c1", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"atc_codes_to_rxnorm_products\"\nwhere rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.735708Z", "completed_at": "2025-05-29T02:24:58.738698Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.738989Z", "completed_at": "2025-05-29T02:24:58.738994Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038976669311523438, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_atc_codes_to_rxnorm_products_rxcui.b171565c1d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"atc_codes_to_rxnorm_products\"\nwhere rxcui is not null\ngroup by rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.740295Z", "completed_at": "2025-05-29T02:24:58.743800Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.744088Z", "completed_at": "2025-05-29T02:24:58.744093Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0044138431549072266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.all_ndc_descriptions", "compiled": true, "compiled_code": "-- all_ndc_descriptions.sql\n\nwith \n\n/*\nNOTE: this intermediate table is only NDCs that have\nSAB = RXNORM RXCUIs, which limits the total NDC count - \nthere are lots of NDCs that don't have RXNORM RXCUIs\nthat might be good to include in the future, but a lot\nseem to be inactive or not prescribable\nMTHSPL = 174k+, VANDF = 309k+, CVX = 500+\n*/\nrxnorm_ndcs as (\n\n    select\n        ndc\n        , product_rxcui as rxcui\n        , product_name as rxnorm_description\n    from \"sagerx\".\"sagerx_dev\".\"int_rxnorm_ndcs_to_products\"\n\n) \n\n/* \nNOTE: maybe want to make a stg_rxnorm__products table\nto replace this weird one-off table\n*/\n, rxnorm_product_rxcuis as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__product_rxcuis\"\n\n)\n\n/*\nNOTE: do we really only want the most recent historical NDCs?\nmaybe should mash rxnorm_historical_ndcs up against rxnorm_ndcs\nand somehow filter out any parts that are wrong?\n*/\n, most_recent_rxnorm_historical_ndcs as (\n\n    select\n        rxnorm_historical_most_recent_ndcs.ndc::varchar\n        , rxnorm_historical_most_recent_ndcs.rxcui::varchar\n        , rxnorm_product_rxcuis.str as rxnorm_description\n    from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm_historical__most_recent_ndcs\" rxnorm_historical_most_recent_ndcs\n    left join rxnorm_product_rxcuis\n        on rxnorm_product_rxcuis.rxcui = rxnorm_historical_most_recent_ndcs.rxcui::varchar\n\n)\n\n, fda_ndc_ndcs as (\n\n    select\n        ndc11 as ndc\n        , trim(concat(\n            nonproprietaryname\n            , ' '\n            , active_numerator_strength\n            , ' '\n            , active_ingred_unit\n            , ' '\n            , lower(dosageformname)\n            , case when proprietaryname is not null then concat(\n                ' ['\n                , proprietaryname\n                , case when proprietarynamesuffix is not null then concat(\n                    ' '\n                    , proprietarynamesuffix\n                    ) else '' end\n                , ']'\n                ) else '' end\n            )) as fda_description\n    from \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"\n\n)\n\n, fda_unfinished_ndcs as (\n\n    select\n        ndc11 as ndc\n        , trim(concat(\n            nonproprietaryname\n            , ' '\n            , active_numerator_strength\n            , ' '\n            , active_ingred_unit\n            , ' '\n            , lower(dosageformname)\n            )) as fda_description\n    from \"sagerx\".\"sagerx_dev\".\"stg_fda_unfinished__ndcs\"\n\n)\n\n, fda_excluded_ndcs as (\n\n    select\n        ndc11 as ndc\n        , trim(concat(\n            nonproprietaryname\n            , ' '\n            , active_numerator_strength\n            , ' '\n            , active_ingred_unit\n            , ' '\n            , lower(dosageformname)\n            , case when proprietaryname is not null then concat(\n                ' ['\n                , proprietaryname\n                , case when proprietarynamesuffix is not null then concat(\n                    ' '\n                    , proprietarynamesuffix\n                    ) else '' end\n                , ']'\n                ) else '' end\n            )) as fda_description\n    from \"sagerx\".\"sagerx_dev\".\"stg_fda_excluded__ndcs\"\n\n)\n\n, all_rxnorm_ndcs as (\n    \n    select *, 1 as table_rank from rxnorm_ndcs\n\n    union\n\n    select *, 2 as table_rank from most_recent_rxnorm_historical_ndcs\n\n)\n\n, ranked_rxnorm_ndcs as (\n\n    select\n        *\n        , row_number() over (partition by ndc order by table_rank asc) as row_num\n    from all_rxnorm_ndcs\n\n)\n\n, distinct_rxnorm_ndcs as (\n\n    select\n        ndc\n        , rxcui\n        , rxnorm_description\n    from ranked_rxnorm_ndcs\n    where row_num = 1\n\n)\n\n, all_fda_ndcs as (\n\n    select *, 1 as table_rank from fda_ndc_ndcs\n    \n    union\n    \n    select *, 2 as table_rank from fda_excluded_ndcs\n\n    union\n\n    select *, 3 as table_rank from fda_unfinished_ndcs    \n\n)\n\n, ranked_fda_ndcs as (\n\n    select\n        *\n        , row_number() over (partition by ndc order by table_rank asc) as row_num\n    from all_fda_ndcs\n\n)\n\n, distinct_fda_ndcs as (\n\n    select\n        ndc\n        , fda_description\n    from ranked_fda_ndcs\n    where row_num = 1\n\n)\n\n, all_ndcs as (\n\n    select ndc from distinct_rxnorm_ndcs\n\n    union\n    \n    select ndc from distinct_fda_ndcs\n\n)\n\n, all_ndc_descriptions as (\n\n    select\n        all_ndcs.ndc\n        , rxcui\n        , rxnorm_description\n        , fda_description\n    from all_ndcs\n    left join distinct_rxnorm_ndcs\n        on distinct_rxnorm_ndcs.ndc = all_ndcs.ndc\n    left join distinct_fda_ndcs\n        on distinct_fda_ndcs.ndc = all_ndcs.ndc\n\n)\n\n, all_not_null_ndc_descriptions as (\n\nselect * from all_ndc_descriptions\nwhere ndc is not null\n\n)\n\nselect * from all_not_null_ndc_descriptions", "relation_name": "\"sagerx\".\"sagerx_dev\".\"all_ndc_descriptions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.745396Z", "completed_at": "2025-05-29T02:24:58.748831Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.749129Z", "completed_at": "2025-05-29T02:24:58.749134Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004362344741821289, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_umls_clinical_products_to_crosswalk_codes", "compiled": true, "compiled_code": "-- int_umls_clinical_products_to_crosswalk_codes.sql\n\nwith\n\nclinical_products_to_ingredient_components as (\n\n    select\n        clinical_product_rxcui,\n        clinical_product_name,\n        clinical_product_tty,\n        ingredient_component_rxcui,\n        ingredient_component_name,\n        ingredient_component_tty\n    from \"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ingredient_components\"\n\n),\n\nclinical_products_to_multiple_ingredients as (\n\n    select\n        ingredient_rxcui as multiple_ingredient_rxcui,\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ingredients\"\n    where ingredient_tty = 'MIN'\n\n),\n\nclinical_products_to_precise_ingredients as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_rxnorm_clinical_products_to_ingredient_strengths\"\n    where precise_ingredient_rxcui is not null\n),\n\ningredient_component_crosswalk_codes as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_umls_ingredient_components_to_crosswalk_codes\"\n\n),\n\nmultiple_ingredient_crosswalk_codes as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_umls_multiple_ingredients_to_crosswalk_codes\"\n\n),\n\nprecise_ingredient_crosswalk_codes as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_umls_precise_ingredients_to_crosswalk_codes\"\n\n),\n\nfinal as (\n\n    select\n        clinical_products.clinical_product_rxcui,\n        clinical_products.clinical_product_name,\n        clinical_products.clinical_product_tty,\n        crosswalk_codes.ingredient_component_rxcui as via_ingredient_rxcui,\n        crosswalk_codes.ingredient_component_name as via_ingredient_name,\n        crosswalk_codes.ingredient_component_tty as via_ingredient_tty,\n        crosswalk_codes.rela,\n        crosswalk_codes.class_id,\n        crosswalk_codes.class_name,\n        crosswalk_codes.class_type,\n        crosswalk_codes.rela_source,\n        crosswalk_codes.from_source,\n        crosswalk_codes.from_code,\n        crosswalk_codes.to_source,\n        crosswalk_codes.to_code,\n        crosswalk_codes.to_name\n    from clinical_products_to_ingredient_components clinical_products\n    inner join ingredient_component_crosswalk_codes crosswalk_codes\n        on crosswalk_codes.ingredient_component_rxcui = clinical_products.ingredient_component_rxcui\n\n    union\n\n    select\n        clinical_products.clinical_product_rxcui,\n        clinical_products.clinical_product_name,\n        clinical_products.clinical_product_tty,\n        crosswalk_codes.multiple_ingredient_rxcui as via_ingredient_rxcui,\n        crosswalk_codes.multiple_ingredient_name as via_ingredient_name,\n        crosswalk_codes.multiple_ingredient_tty as via_ingredient_tty,\n        crosswalk_codes.rela,\n        crosswalk_codes.class_id,\n        crosswalk_codes.class_name,\n        crosswalk_codes.class_type,\n        crosswalk_codes.rela_source,\n        crosswalk_codes.from_source,\n        crosswalk_codes.from_code,\n        crosswalk_codes.to_source,\n        crosswalk_codes.to_code,\n        crosswalk_codes.to_name\n    from clinical_products_to_multiple_ingredients clinical_products\n    inner join multiple_ingredient_crosswalk_codes crosswalk_codes\n        on crosswalk_codes.multiple_ingredient_rxcui = clinical_products.multiple_ingredient_rxcui\n\n    union\n\n    select\n        clinical_products.clinical_product_rxcui,\n        clinical_products.clinical_product_name,\n        clinical_products.clinical_product_tty,\n        crosswalk_codes.precise_ingredient_rxcui as via_ingredient_rxcui,\n        crosswalk_codes.precise_ingredient_name as via_ingredient_name,\n        crosswalk_codes.precise_ingredient_tty as via_ingredient_tty,\n        crosswalk_codes.rela,\n        crosswalk_codes.class_id,\n        crosswalk_codes.class_name,\n        crosswalk_codes.class_type,\n        crosswalk_codes.rela_source,\n        crosswalk_codes.from_source,\n        crosswalk_codes.from_code,\n        crosswalk_codes.to_source,\n        crosswalk_codes.to_code,\n        crosswalk_codes.to_name\n    from clinical_products_to_precise_ingredients clinical_products\n    inner join precise_ingredient_crosswalk_codes crosswalk_codes\n        on crosswalk_codes.precise_ingredient_rxcui = clinical_products.precise_ingredient_rxcui\n\n)\n\nselect * from final", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_umls_clinical_products_to_crosswalk_codes\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.750428Z", "completed_at": "2025-05-29T02:24:58.752559Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.752867Z", "completed_at": "2025-05-29T02:24:58.752872Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0030591487884521484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_dailymed_ranked_package_label_ndcs", "compiled": true, "compiled_code": "with\n\nvalidated_package_ndcs as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"int_dailymed_validated_package_label_ndcs\"\n\n),\n\nranked_package_ndcs as (\n\n    select \n        *,\n        row_number() over (\n            partition by package_label_section_id\n            order by id\n        ) as rn\n    from validated_package_ndcs\n\n)\n\nselect * from ranked_package_ndcs", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_dailymed_ranked_package_label_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.754182Z", "completed_at": "2025-05-29T02:24:58.756476Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.756754Z", "completed_at": "2025-05-29T02:24:58.756759Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0031995773315429688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_fda_packaging_subparts", "compiled": true, "compiled_code": "\n\nwith \n\npackaging_parts as (\n\tselect * from \"sagerx\".\"sagerx_dev\".\"int_fda_packaging_parts\"\n\twhere part_text like ('%/%')\n)\n\nselect\n\tz.ndc11\n    , z.packagedescription\n\t, z.component_line\n\t, z.component_text\n    , z.part_line\n    , z.part_text\n   \t, z.ordinality as subpart_line\n\t, trim(z.token) as subpart_text\nfrom (\n    select distinct \n        parts.*\n\t    , s.token\n        , s.ordinality\n\tfrom\n\t\tpackaging_parts parts\n\t\t, unnest(\n\t\t\tstring_to_array(\n\t\t\t\tpart_text\n\t\t\t\t, '/')\n\t\t\t) with ordinality as s(token, ordinality)\n) z\norder by ndc11, component_line, part_line, subpart_line", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_fda_packaging_subparts\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.758042Z", "completed_at": "2025-05-29T02:24:58.760429Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.760702Z", "completed_at": "2025-05-29T02:24:58.760706Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00342559814453125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.pricing", "compiled": true, "compiled_code": "-- pricing.sql\n\nwith\n\nnadac as (\n\n    select\n        *\n    from \"sagerx\".\"sagerx_dev\".\"int_nadac_pricing\"\n\n),\n\nmccpd as (\n\n    select\n        *\n    -- TODO: make a stanging table and int table instead of hitting source in a mart\n    from \"sagerx\".\"sagerx_lake\".\"mccpd\"\n),\n\nall_ndcs as (\n\n    select ndc from nadac\n\n    union\n\n    select ndc from mccpd\n\n),\n\npricing as (\n\n    select\n        all_ndcs.*,\n        nadac.ndc_description as nadac_description,\n        nadac.nadac_per_unit,\n        mccpd.medication_name as mccpd_description,\n        mccpd.unit_billing_price,\n        mccpd.unit_price\n    from all_ndcs\n    left join nadac\n        on nadac.ndc = all_ndcs.ndc\n    left join mccpd\n        on mccpd.ndc = all_ndcs.ndc\n\n)\n\nselect * from pricing", "relation_name": "\"sagerx\".\"sagerx_dev\".\"pricing\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.762178Z", "completed_at": "2025-05-29T02:24:58.765112Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.765393Z", "completed_at": "2025-05-29T02:24:58.765397Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0038335323333740234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_int_nadac_pricing_ndc.b2ae620a53", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc\nfrom \"sagerx\".\"sagerx_dev\".\"int_nadac_pricing\"\nwhere ndc is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.766683Z", "completed_at": "2025-05-29T02:24:58.769573Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.769852Z", "completed_at": "2025-05-29T02:24:58.769857Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037839412689208984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_int_nadac_pricing_ndc.f68c3e3cde", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    ndc as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"int_nadac_pricing\"\nwhere ndc is not null\ngroup by ndc\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.771141Z", "completed_at": "2025-05-29T02:24:58.774072Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.774358Z", "completed_at": "2025-05-29T02:24:58.774363Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003833770751953125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_products_product_rxcui.fa0e88a9af", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect product_rxcui\nfrom \"sagerx\".\"sagerx_dev\".\"products\"\nwhere product_rxcui is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.775675Z", "completed_at": "2025-05-29T02:24:58.778568Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.778846Z", "completed_at": "2025-05-29T02:24:58.778850Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037832260131835938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_products_product_rxcui.72c98af3cb", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    product_rxcui as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"products\"\nwhere product_rxcui is not null\ngroup by product_rxcui\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.780146Z", "completed_at": "2025-05-29T02:24:58.782249Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.782524Z", "completed_at": "2025-05-29T02:24:58.782528Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0029959678649902344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.scorecard_data", "compiled": true, "compiled_code": "with\n\ning_to_report as (\n\n    select * from \"sagerx\".\"sagerx_dev\".\"int_inactive_ingredients_to_fda_enforcement_reports\"\n\n)\n\nselect * from ing_to_report\nwhere active_ingredient_name in (\n    'risperidone'\n    , 'adalimumab'\n    , 'lidocaine'\n    , 'carbamazepine'\n    , 'phenytoin'\n    , 'midazolam'\n    , 'valproate'\n    , 'tacrolimus'\n    , 'amoxicillin'\n    , 'hydrocortisone'\n    , 'cetirizine'\n    , 'pertuzumab'\n    , 'methylphenidate'\n    , 'erythromycin'\n    , 'gabapentin'\n    , 'lopinavir / ritonavir'\n    , 'levothyroxine'\n    , 'albuterol'\n    )", "relation_name": "\"sagerx\".\"sagerx_dev\".\"scorecard_data\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.783843Z", "completed_at": "2025-05-29T02:24:58.788506Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.788783Z", "completed_at": "2025-05-29T02:24:58.788787Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005582571029663086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.all_ndcs_to_sources", "compiled": true, "compiled_code": "-- stg_ndc_all_ndcs_to_sources.sql\n\nwith rxnorm_historical_ndcs as\n(\n    -- NOTE: likely need to pick the most recent NDC\n    -- instead of just distinct\n    -- and pull in the other columns too possibly\n    select distinct ndc\n    from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm_historical__ndcs\"\n)\n\n, rxnorm_ndcs as\n(\n    select distinct ndc\n    from \"sagerx\".\"sagerx_dev\".\"stg_rxnorm__ndcs\"\n)\n\n, fda_ndc_ndcs as\n(\n    select distinct ndc11 as ndc\n    from \"sagerx\".\"sagerx_dev\".\"stg_fda_ndc__ndcs\"\n)\n\n, fda_excluded_ndcs as\n(\n    select distinct ndc11 as ndc\n    from \"sagerx\".\"sagerx_dev\".\"stg_fda_excluded__ndcs\"\n)\n\n, fda_unfinished_ndcs as\n(\n    select distinct ndc11 as ndc\n    from \"sagerx\".\"sagerx_dev\".\"stg_fda_unfinished__ndcs\"\n)\n\n, all_distinct_ndcs as\n(\n    select ndc from rxnorm_historical_ndcs\n    union\n    select ndc from rxnorm_ndcs\n    union\n    select ndc from fda_ndc_ndcs\n    union\n    select ndc from fda_excluded_ndcs\n    union\n    select ndc from fda_unfinished_ndcs\n)\n\n, all_ndcs_to_sources as (\n    select\n        all_distinct_ndcs.ndc\n        , case when rxnorm_historical_ndcs.ndc is not null\n            then 1 \n            else 0\n            end as rxnorm_historical_ndcs\n        , case when rxnorm_ndcs.ndc is not null\n            then 1 \n            else 0\n            end as rxnorm_ndcs\n        , case when fda_ndc_ndcs.ndc is not null\n            then 1 \n            else 0\n            end as fda_ndc_ndcs\n        , case when fda_excluded_ndcs.ndc is not null\n            then 1 \n            else 0\n            end as fda_excluded_ndcs\n        , case when fda_unfinished_ndcs.ndc is not null\n            then 1 \n            else 0\n            end as fda_unfinished_ndcs\n    from all_distinct_ndcs\n    left join rxnorm_historical_ndcs\n        on rxnorm_historical_ndcs.ndc = all_distinct_ndcs.ndc\n    left join rxnorm_ndcs\n        on rxnorm_ndcs.ndc = all_distinct_ndcs.ndc\n    left join fda_ndc_ndcs\n        on fda_ndc_ndcs.ndc = all_distinct_ndcs.ndc\n    left join fda_excluded_ndcs\n        on fda_excluded_ndcs.ndc = all_distinct_ndcs.ndc\n    left join fda_unfinished_ndcs\n        on fda_unfinished_ndcs.ndc = all_distinct_ndcs.ndc\n)\n\n, all_not_null_ndcs_to_sources as (\n    select\n        *\n    from all_ndcs_to_sources\n    where ndc is not null\n)\n\n, all_ndc_descriptions as (\n    select * from \"sagerx\".\"sagerx_dev\".\"all_ndc_descriptions\"\n)\n\n, all_ndcs_with_descriptions_to_sources as (\n    select\n        all_not_null_ndcs_to_sources.*\n    from all_not_null_ndcs_to_sources\n    inner join all_ndc_descriptions\n        on all_ndc_descriptions.ndc = all_not_null_ndcs_to_sources.ndc\n)\n\nselect * from all_ndcs_with_descriptions_to_sources", "relation_name": "\"sagerx\".\"sagerx_dev\".\"all_ndcs_to_sources\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.790130Z", "completed_at": "2025-05-29T02:24:58.793055Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.793346Z", "completed_at": "2025-05-29T02:24:58.793351Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003870725631713867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.not_null_all_ndc_descriptions_ndc.5637013605", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ndc\nfrom \"sagerx\".\"sagerx_dev\".\"all_ndc_descriptions\"\nwhere ndc is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.794684Z", "completed_at": "2025-05-29T02:24:58.797557Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.797832Z", "completed_at": "2025-05-29T02:24:58.797836Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0037636756896972656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.sagerx.unique_all_ndc_descriptions_ndc.e6968eba9b", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    ndc as unique_field,\n    count(*) as n_records\n\nfrom \"sagerx\".\"sagerx_dev\".\"all_ndc_descriptions\"\nwhere ndc is not null\ngroup by ndc\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.799154Z", "completed_at": "2025-05-29T02:24:58.801307Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.801586Z", "completed_at": "2025-05-29T02:24:58.801590Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003052234649658203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.clinical_products_to_diseases", "compiled": true, "compiled_code": "with\n\nclinical_products_crosswalk as (\n    \n    select\n        clinical_product_rxcui,\n        clinical_product_name,\n        clinical_product_tty,\n        via_ingredient_rxcui,\n        via_ingredient_name,\n        via_ingredient_tty,\n        rela,\n        rela_source,\n        class_id,\n        class_name,\n        class_type,\n        to_code as disease_id,\n        to_source as disease_source,\n        to_name as disease_name        \n    from \"sagerx\".\"sagerx_dev\".\"int_umls_clinical_products_to_crosswalk_codes\"\n\n)\n\nselect * from clinical_products_crosswalk", "relation_name": "\"sagerx\".\"sagerx_dev\".\"clinical_products_to_diseases\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.802880Z", "completed_at": "2025-05-29T02:24:58.805164Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.805446Z", "completed_at": "2025-05-29T02:24:58.805450Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0031766891479492188, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.int_dailymed_image_xml_ndcs", "compiled": true, "compiled_code": "-- int_dailymed_image_xml_ndcs\n\nwith\n\nranked_package_label_images as\n(\n\n    select * from \"sagerx\".\"sagerx_dev\".\"int_dailymed_ranked_package_label_images\"\n\n),\n\nranked_package_label_ndcs as\n(\n\n    select * from \"sagerx\".\"sagerx_dev\".\"int_dailymed_ranked_package_label_ndcs\"\n\n)\n\nselect\n\timg.set_id,\n\tndc.ndc,\n\timg.image\nfrom ranked_package_label_images img\nleft join ranked_package_label_ndcs ndc\n\ton ndc.package_label_section_id = img.package_label_section_id\n\tand ndc.rn = img.rn\nwhere ndc.ndc is not null", "relation_name": "\"sagerx\".\"sagerx_dev\".\"int_dailymed_image_xml_ndcs\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-05-29T02:24:58.807190Z", "completed_at": "2025-05-29T02:24:58.809830Z"}, {"name": "execute", "started_at": "2025-05-29T02:24:58.810118Z", "completed_at": "2025-05-29T02:24:58.810123Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003557443618774414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.sagerx.ndcs_to_label_images", "compiled": true, "compiled_code": "-- ndcs_to_label_images\n\nwith\n\nimage_xml_ndcs as (\n\n\tselect * from \"sagerx\".\"sagerx_dev\".\"int_dailymed_image_xml_ndcs\"\n\n\n),\n\nimage_name_ndcs as (\n\n\tselect * from \"sagerx\".\"sagerx_dev\".\"int_dailymed_image_name_ndcs\"\n\n),\n\nall_image_ndcs as (\n\n\tselect\n\t\tset_id,\n\t\tndc,\n\t\timage\t\n\tfrom image_xml_ndcs\n\n\tunion\n\n\tselect\n\t\tset_id,\n\t\tndc,\n\t\timage\n\tfrom image_name_ndcs\n\n),\n\nall_image_ndcs_ndc11 as (\n\n\tselect\n\t\tset_id,\n\t\tndc,\n\t\t\n  \n  CASE WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n = '10 Digit' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '11 Digit' THEN ndc\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-4-2' THEN '0' || LEFT(ndc,4) || REPLACE(RIGHT(ndc,7),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-3-2' THEN LEFT(ndc,5) || '0' || REPLACE(RIGHT(ndc,6),'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-1' THEN REPLACE(LEFT(ndc,10),'-','') || '0' || RIGHT(ndc, 1)\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-4-2' THEN REPLACE(ndc,'-','')\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '5-5' THEN NULL\n     WHEN \n  \n  \n    CASE WHEN ndc ~ '^\\d{10}$' THEN '10 Digit'\n        WHEN ndc ~ '^\\d{11}$' THEN '11 Digit'\n        WHEN ndc ~ '^\\d{4}-\\d{4}-\\d{2}$' THEN '4-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{3}-\\d{2}$' THEN '5-3-2'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{1}$' THEN '5-4-1'\n        WHEN ndc ~ '^\\d{5}-\\d{4}-\\d{2}$' THEN '5-4-2'\n        WHEN ndc ~ '^\\d{5}-\\d{5}$' THEN '5-5'\n        WHEN ndc ~ '^\\d{4}-\\d{6}$' THEN '4-6'\n\t  ELSE 'Unknown'\n\t  END\n  \n =  '4-6' THEN NULL\n  ELSE NULL\n  END\n  \n as ndc11,\n\t\tconcat('https://dailymed.nlm.nih.gov/dailymed/image.cfm?name=', image, '&setid=', set_id) as image_url,\n\t\timage as image_file,\n\t\tconcat('https://dailymed.nlm.nih.gov/dailymed/drugInfo.cfm?setid=', set_id) as dailymed_spl_url\n\tfrom all_image_ndcs\n\n)\n\nselect * from all_image_ndcs_ndc11", "relation_name": "\"sagerx\".\"sagerx_dev\".\"ndcs_to_label_images\"", "batch_results": null}], "elapsed_time": 0.8836519718170166, "args": {"cache_selected_only": false, "defer": false, "project_dir": "/dbt/sagerx", "require_explicit_package_overrides_for_builtin_materializations": true, "empty_catalog": false, "static_parser": true, "log_level": "info", "exclude": [], "compile": true, "require_yaml_configuration_for_mf_time_spines": false, "populate_cache": true, "static": false, "strict_mode": false, "source_freshness_run_project_hooks": false, "warn_error_options": {"include": [], "exclude": []}, "write_json": true, "indirect_selection": "eager", "log_format": "default", "log_format_file": "debug", "log_file_max_bytes": 10485760, "skip_nodes_if_on_run_start_fails": false, "log_level_file": "debug", "profiles_dir": "/dbt", "partial_parse_file_diff": true, "partial_parse": true, "vars": {}, "introspect": true, "quiet": false, "favor_state": false, "log_path": "/dbt/sagerx/logs", "version_check": true, "state_modified_compare_more_unrendered_values": false, "print": true, "require_nested_cumulative_type_params": false, "state_modified_compare_vars": false, "select": [], "require_resource_names_without_spaces": false, "which": "generate", "require_batched_execution_for_custom_microbatch_strategy": false, "send_anonymous_usage_stats": true, "invocation_command": "dbt docs generate", "printer_width": 80, "use_colors": true, "macro_debugging": false, "use_colors_file": true, "show_resource_report": false}}