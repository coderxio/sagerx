version: 2

models:
  - name: ndcs
    description: |
      A list of all NDCs from every available source.
      
      NDC to RxNorm description (with RXCUI) and FDA description.

      NOTE: If RxNorm and RxNorm Historical have same NDCs, we prefer RxNorm.
      If any of the 3 FDA sources have same NDCs, we prefer FDA NDC, FDA Excluded, FDA Unfinished in that order.
    columns:
      - name: ndc
        description: The NDC in NDC11 format. This column contains only unique values.
        tests:
          - unique
          - not_null
      - name: rxcui
        description: >
          If NDC was found in an RxNorm sources, we have an associated RXCUI.
          If NULL, the source is likely FDA.
      - name: rxnorm_description
        description: If RxNorm source, will have the RxNorm normalized description (STR).
      - name: fda_description
        description: If FDA source, will have a description cobbled together from FDA columns for lack of a normalized FDA description.

  - name: ndc_inactive_ingredients
    description: |
      DailyMed (MTHSPL) products (along with 9-digit NDCs), mapped to DailyMed
      substances, which are mapped to normalized FDA UNII display names.

      Also included is a column that attempts to flag inactive ingredients
      as preservatives using a hard-coded USP definition as a CSV file seed.
    columns:
      - name: ndc9
      - name: fda_unii_code
      - name: fda_unii_display_name
      - name: pubchem_id
        description: >
          The ID for this compound in PubChem.

          Use this to generate a link to the PubChem detail
          page for this compound.

          Example: `concat('https://pubchem.ncbi.nlm.nih.gov/compound/', pubchem_id)`

          Sodium Benzoate example: [https://pubchem.ncbi.nlm.nih.gov/compound/517055](https://pubchem.ncbi.nlm.nih.gov/compound/517055)
      - name: usp_preservative
        description: |
          1 if the UNII matches a CAS RN from USP where
          USP considers it a preservative based on preservative
          product filter on their product website.

          USP product website filtered to Preservatives: [link](https://store.usp.org/preservatives/category/USP-1213)

          29 products at the time of writing this - one of which had N/A for CAS RN
          and one which had two possible CAS RNs.
      - name: product_rxcui
      - name: product_name
        description: |
          NOTE: this field is aggregated and pipe-delimited (' | '). It appears
          as though the MTHSPL data in RxNorm can have multiple
          product names for a given RXCUI. Since we are mostly concerned
          with NDC to UNII code, the names of the products as they
          exist in the MTHSPL SAB of RxNorm should be for quick reference
          and validation only.
      - name: product_tty
      - name: inactive_ingredient_unii
      - name: inactive_ingredient_rxcui
      - name: inactive_ingredient_name
        description: |
          NOTE: this field is aggregated and pipe-delimited (' | '). It appears
          as though the MTHSPL data in RxNorm can have multiple
          substance names for a given RXCUI. Since we are mostly concerned
          with NDC to UNII code, the names of the substances as they
          exist in the MTHSPL SAB of RxNorm should be for quick reference
          and validation only.
      - name: inactive_ingredient_tty
      - name: active
      - name: prescribable
